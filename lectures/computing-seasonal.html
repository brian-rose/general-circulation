
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. Computing seasonal means from CFSR data &#8212; ATM 622: General Circulation of the Atmosphere</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. The observed circulation" href="observed-circulation.html" />
    <link rel="prev" title="1. Earth’s radiation budget" href="radiation-budget.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ATM 622: General Circulation of the Atmosphere</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../home.html">
                    ATM 622: General Circulation of the Atmosphere
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course info
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../info/syllabus.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../info/schedule.html">
   Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../info/how-to.html">
   How to use this book
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="radiation-budget.html">
   1. Earth’s radiation budget
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. Computing seasonal means from CFSR data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="observed-circulation.html">
   3. The observed circulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="decomposing-circulation.html">
   4. Decompositions of the circulation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments and labs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/assignment-toa-budget.html">
   1. Top-of-Atmosphere Radiation Budget and Meridional Energy Transport
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The stuff at the end
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../info/references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/brian-rose/general-circulation/main?urlpath=lab/tree/./lectures/computing-seasonal.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://lore.atmos.albany.edu:8000/hub/user-redirect/git-pull?repo=https%3A//github.com/brian-rose/general-circulation&urlpath=lab/tree/general-circulation/./lectures/computing-seasonal.ipynb&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/brian-rose/general-circulation"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/brian-rose/general-circulation/issues/new?title=Issue%20on%20page%20%2Flectures/computing-seasonal.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/lectures/computing-seasonal.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-cfsr-data">
   The CFSR data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opening-handles-to-the-dataset">
   Opening handles to the dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#assembling-paths-to-all-the-data">
     Assembling paths to all the data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#passing-through-paths-to-xarray-open-mfdataset">
     Passing through paths to
     <code class="docutils literal notranslate">
      <span class="pre">
       xarray.open_mfdataset()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dask-and-lazy-execution">
     Dask and lazy execution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-the-seasonal-climatology">
   Creating the seasonal climatology
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping-by-season">
     Grouping by season
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definining-the-climatology">
     Definining the climatology
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-climatology-to-disk">
   Saving the climatology to disk
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#doing-it-all-again">
   Doing it all again
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Computing seasonal means from CFSR data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-cfsr-data">
   The CFSR data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opening-handles-to-the-dataset">
   Opening handles to the dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#assembling-paths-to-all-the-data">
     Assembling paths to all the data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#passing-through-paths-to-xarray-open-mfdataset">
     Passing through paths to
     <code class="docutils literal notranslate">
      <span class="pre">
       xarray.open_mfdataset()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dask-and-lazy-execution">
     Dask and lazy execution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-the-seasonal-climatology">
   Creating the seasonal climatology
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping-by-season">
     Grouping by season
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definining-the-climatology">
     Definining the climatology
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-climatology-to-disk">
   Saving the climatology to disk
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#doing-it-all-again">
   Doing it all again
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="computing-seasonal-means-from-cfsr-data">
<h1><span class="section-number">2. </span>Computing seasonal means from CFSR data<a class="headerlink" href="#computing-seasonal-means-from-cfsr-data" title="Permalink to this headline">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>These notes will show how to:</p>
<ol class="simple">
<li><p>Access the 6-hourly CFSR dataset on our local disks</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset()</span></code> to concatenate data spread across many individual netCDF files into a single dataset</p></li>
<li><p>Take advantage of xarray’s “lazy execution” model to define our climatology before explicitly computing any results</p></li>
<li><p>Compute the climatology (seasonal means) and save the resulting (vastly) reduced datasets to disk as netCDF files</p></li>
</ol>
<p><em><strong>Note, this code takes a long time to run! And there is really no need to run it again because we are saving the results to disk.</strong></em></p>
<p>This is just for demonstration purposes.</p>
</section>
<section id="the-cfsr-data">
<h2>The CFSR data<a class="headerlink" href="#the-cfsr-data" title="Permalink to this headline">#</a></h2>
<p>The <a class="reference external" href="https://climatedataguide.ucar.edu/climate-data/climate-forecast-system-reanalysis-cfsr">Climate Forecase System Reanalysis</a> or CFSR is a reanalysis data product giving a best estimate of the state of the coupled climate system since 1979 based on a blend of observations and numerical model.</p>
<blockquote>
<div><p>The CFSR is a third generation reanalysis product. It is a global, high resolution, coupled atmosphere-ocean-land surface-sea ice system designed to provide the best estimate of the state of these coupled domains over this period. The CFSR includes (1) coupling of atmosphere and ocean during the generation of the 6 hour guess field, (2) an interactive sea-ice model, and (3) assimilation of satellite radiances. The CFSR global atmosphere resolution is ~38 km (T382) with 64 levels. The global ocean is 0.25° at the equator, extending to a global 0.5° beyond the tropics, with 40 levels. The global land surface model has 4 soil levels and the global sea ice model has 3 levels. The CFSR atmospheric model contains observed variations in carbon dioxide (CO2), together with changes in aerosols and other trace gases and solar variations. With these variable parameters, the analyzed state will include estimates of changes in the Earth system climate due to these factors. The current CFSR will be extended as an operational, real time product into the future.</p>
</div></blockquote>
<p>We maintain a continuously updated local copy of the 6-hourly CFSR data on shared disks here in DAES. You can browse the available data through this catalog:</p>
<p><a class="reference external" href="http://thredds.atmos.albany.edu:8080/thredds/catalog/CFSR/catalog.html">http://thredds.atmos.albany.edu:8080/thredds/catalog/CFSR/catalog.html</a></p>
<p>That links takes you to a so-called THREDDS server which provides remote access to the data. However we’re always going to get <em>much</em> better performance with local access to the file system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thredds_path</span> <span class="o">=</span> <span class="s1">&#39;http://thredds.atmos.albany.edu:8080/thredds/dodsC/CFSR/&#39;</span> 
<span class="n">local_path</span> <span class="o">=</span> <span class="s1">&#39;/cfsr/data/&#39;</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">local_path</span>  <span class="c1"># switch this to thredds_path if running remotely ... but much poorer performance</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a peak at one directory of data from a particular year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">/</span><span class="n">cfsr</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">2000</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>g.2000.0p5.anl.nc        q.2000.0p5.anl.nc       u_pv.2000.0p5.anl.nc
pmsl.2000.0p5.anl.nc     t.2000.0p5.anl.nc       v.2000.0p5.anl.nc
pres_pv.2000.0p5.anl.nc  t_pv.2000.0p5.anl.nc    v_isen.2000.0p5.anl.nc
psfc.2000.0p5.anl.nc     tsfc.2000.0p5.anl.nc    v_pv.2000.0p5.anl.nc
pv_isen.2000.0p5.anl.nc  u.2000.0p5.anl.nc       w.2000.0p5.anl.nc
pwat.2000.0p5.anl.nc     u_isen.2000.0p5.anl.nc
</pre></div>
</div>
</div>
</div>
<p>We can see 17 different fields stored in individual netCDF files labeled with their calendar year.</p>
<p>Our goal is to <strong>compute a 30-year seasonal climatology</strong> for all variables. So we are going to begin by opening handles to 30 years of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># It&#39;s helpful to store all the variable names in this list</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pmsl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pres_pv&#39;</span><span class="p">,</span>
             <span class="s1">&#39;psfc&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pv_isen&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pwat&#39;</span><span class="p">,</span>
             <span class="s1">&#39;q&#39;</span><span class="p">,</span>
             <span class="s1">&#39;t&#39;</span><span class="p">,</span>
             <span class="s1">&#39;t_pv&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tsfc&#39;</span><span class="p">,</span>
             <span class="s1">&#39;u&#39;</span><span class="p">,</span>
             <span class="s1">&#39;u_isen&#39;</span><span class="p">,</span>
             <span class="s1">&#39;u_pv&#39;</span><span class="p">,</span>
             <span class="s1">&#39;v&#39;</span><span class="p">,</span>
             <span class="s1">&#39;v_isen&#39;</span><span class="p">,</span>
             <span class="s1">&#39;v_pv&#39;</span><span class="p">,</span>
             <span class="s1">&#39;w&#39;</span><span class="p">,</span>
            <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="opening-handles-to-the-dataset">
<h2>Opening handles to the dataset<a class="headerlink" href="#opening-handles-to-the-dataset" title="Permalink to this headline">#</a></h2>
<p>Here we are going to assemble a list of paths to every data file that we want to concatenate into a single dataset.</p>
<section id="assembling-paths-to-all-the-data">
<h3>Assembling paths to all the data<a class="headerlink" href="#assembling-paths-to-all-the-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmsl_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;pmsl&#39;</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span><span class="mi">2018</span><span class="p">):</span>  <span class="c1"># choosing years 1988 through 2017 because there is some missing data after 2017</span>
    <span class="c1">#for var in variables:</span>
    <span class="n">pmsl_filepath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;.0p5.anl.nc&#39;</span>
    <span class="n">pmsl_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmsl_filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a peek at part of the list we just created:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmsl_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/cfsr/data/1988/pmsl.1988.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1989/pmsl.1989.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1990/pmsl.1990.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1991/pmsl.1991.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1992/pmsl.1992.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1993/pmsl.1993.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1994/pmsl.1994.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1995/pmsl.1995.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1996/pmsl.1996.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1997/pmsl.1997.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1998/pmsl.1998.0p5.anl.nc&#39;,
 &#39;/cfsr/data/1999/pmsl.1999.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2000/pmsl.2000.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2001/pmsl.2001.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2002/pmsl.2002.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2003/pmsl.2003.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2004/pmsl.2004.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2005/pmsl.2005.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2006/pmsl.2006.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2007/pmsl.2007.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2008/pmsl.2008.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2009/pmsl.2009.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2010/pmsl.2010.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2011/pmsl.2011.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2012/pmsl.2012.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2013/pmsl.2013.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2014/pmsl.2014.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2015/pmsl.2015.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2016/pmsl.2016.0p5.anl.nc&#39;,
 &#39;/cfsr/data/2017/pmsl.2017.0p5.anl.nc&#39;]
</pre></div>
</div>
</div>
</div>
<p>Looks good!</p>
</section>
<section id="passing-through-paths-to-xarray-open-mfdataset">
<h3>Passing through paths to <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset()</span></code><a class="headerlink" href="#passing-through-paths-to-xarray-open-mfdataset" title="Permalink to this headline">#</a></h3>
<p>Now we pass our list of path and let Xarray (with Dask in the background) handle the concatenation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="n">pmsl_6hourly</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">pmsl_files</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pmsl_6hourly</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (time: 43832, lat: 361, lon: 720)
Coordinates:
  * time     (time) datetime64[ns] 1988-01-01 ... 2017-12-31T18:00:00
  * lat      (lat) float32 -90.0 -89.5 -89.0 -88.5 -88.0 ... 88.5 89.0 89.5 90.0
  * lon      (lon) float32 -180.0 -179.5 -179.0 -178.5 ... 178.5 179.0 179.5
Data variables:
    pmsl     (time, lat, lon) float32 dask.array&lt;chunksize=(1464, 361, 720), meta=np.ndarray&gt;
Attributes:
    description:    pmsl as a single level variable
    year:           1988
    source:         http://nomads.ncdc.noaa.gov/data.php?name=access#CFSR-data
    references:     Saha, et. al., (2010)
    created_by:     User: kgriffin
    creation_date:  Fri Apr 13 14:12:35 UTC 2012</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-fa9716bd-8fb6-4269-b5a5-c5b274c6e50e' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-fa9716bd-8fb6-4269-b5a5-c5b274c6e50e' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 43832</li><li><span class='xr-has-index'>lat</span>: 361</li><li><span class='xr-has-index'>lon</span>: 720</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-6ce73ca1-41e8-4106-b8e1-cc70daee88d5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6ce73ca1-41e8-4106-b8e1-cc70daee88d5' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1988-01-01 ... 2017-12-31T18:00:00</div><input id='attrs-f999136e-0e81-4837-bc96-63a4aa8b0cba' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f999136e-0e81-4837-bc96-63a4aa8b0cba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-36df5f02-3a3f-43e9-9190-e980fa07bb50' class='xr-var-data-in' type='checkbox'><label for='data-36df5f02-3a3f-43e9-9190-e980fa07bb50' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[1647960. 1656738.]</dd><dt><span>last_time :</span></dt><dd>1988-12-31 18:00:00</dd><dt><span>first_time :</span></dt><dd>1988-1-1 00:00:00</dd><dt><span>delta_t :</span></dt><dd>0000-00-00 06:00:00</dd><dt><span>long_name :</span></dt><dd>initial time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1988-01-01T00:00:00.000000000&#x27;, &#x27;1988-01-01T06:00:00.000000000&#x27;,
       &#x27;1988-01-01T12:00:00.000000000&#x27;, ..., &#x27;2017-12-31T06:00:00.000000000&#x27;,
       &#x27;2017-12-31T12:00:00.000000000&#x27;, &#x27;2017-12-31T18:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-90.0 -89.5 -89.0 ... 89.5 90.0</div><input id='attrs-f8994a75-e4ff-4a37-bf11-65bc0df96d48' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f8994a75-e4ff-4a37-bf11-65bc0df96d48' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b2ff0a36-9d84-45ca-8261-cea843cd0900' class='xr-var-data-in' type='checkbox'><label for='data-b2ff0a36-9d84-45ca-8261-cea843cd0900' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-90  90]</dd><dt><span>delta_y :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([-90. , -89.5, -89. , ...,  89. ,  89.5,  90. ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -179.5 ... 179.0 179.5</div><input id='attrs-1a65c802-0c52-46b7-b7d8-4ccd6a5e76bb' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1a65c802-0c52-46b7-b7d8-4ccd6a5e76bb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-be829ee1-db6d-45b4-9026-87e72f57d3be' class='xr-var-data-in' type='checkbox'><label for='data-be829ee1-db6d-45b4-9026-87e72f57d3be' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-180.   179.5]</dd><dt><span>delta_x :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-180. , -179.5, -179. , ...,  178.5,  179. ,  179.5], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8542c201-82ee-46be-a90a-2a79d0c3ad3f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8542c201-82ee-46be-a90a-2a79d0c3ad3f' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>pmsl</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1464, 361, 720), meta=np.ndarray&gt;</div><input id='attrs-18e41d98-5401-4d4a-b47b-34cca059416b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-18e41d98-5401-4d4a-b47b-34cca059416b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e5ff74d2-2878-49ac-b96f-4c6cbfbbfd21' class='xr-var-data-in' type='checkbox'><label for='data-e5ff74d2-2878-49ac-b96f-4c6cbfbbfd21' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>level_type :</span></dt><dd>single level variable</dd><dt><span>units :</span></dt><dd>Pa</dd><dt><span>long_name :</span></dt><dd>pressure reduced mean sea level</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 42.44 GiB </td>
                        <td> 1.42 GiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (43832, 361, 720) </td>
                        <td> (1464, 361, 720) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 90 Tasks </td>
                        <td> 30 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="158" height="146" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="25" x2="80" y2="96" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="25" style="stroke-width:2" />
  <line x1="12" y1="2" x2="12" y2="27" />
  <line x1="17" y1="7" x2="17" y2="32" />
  <line x1="19" y1="9" x2="19" y2="34" />
  <line x1="24" y1="14" x2="24" y2="39" />
  <line x1="26" y1="16" x2="26" y2="41" />
  <line x1="31" y1="21" x2="31" y2="46" />
  <line x1="35" y1="25" x2="35" y2="51" />
  <line x1="38" y1="28" x2="38" y2="53" />
  <line x1="42" y1="32" x2="42" y2="58" />
  <line x1="45" y1="35" x2="45" y2="60" />
  <line x1="50" y1="40" x2="50" y2="65" />
  <line x1="52" y1="42" x2="52" y2="67" />
  <line x1="57" y1="47" x2="57" y2="72" />
  <line x1="61" y1="51" x2="61" y2="77" />
  <line x1="64" y1="54" x2="64" y2="79" />
  <line x1="68" y1="58" x2="68" y2="84" />
  <line x1="71" y1="61" x2="71" y2="86" />
  <line x1="75" y1="65" x2="75" y2="91" />
  <line x1="80" y1="70" x2="80" y2="96" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,96.00085180870013 10.0,25.41261651458249" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="37" y2="0" style="stroke-width:2" />
  <line x1="12" y1="2" x2="40" y2="2" />
  <line x1="17" y1="7" x2="45" y2="7" />
  <line x1="19" y1="9" x2="47" y2="9" />
  <line x1="24" y1="14" x2="52" y2="14" />
  <line x1="26" y1="16" x2="54" y2="16" />
  <line x1="31" y1="21" x2="59" y2="21" />
  <line x1="35" y1="25" x2="63" y2="25" />
  <line x1="38" y1="28" x2="66" y2="28" />
  <line x1="42" y1="32" x2="70" y2="32" />
  <line x1="45" y1="35" x2="73" y2="35" />
  <line x1="50" y1="40" x2="77" y2="40" />
  <line x1="52" y1="42" x2="80" y2="42" />
  <line x1="57" y1="47" x2="85" y2="47" />
  <line x1="61" y1="51" x2="89" y2="51" />
  <line x1="64" y1="54" x2="92" y2="54" />
  <line x1="68" y1="58" x2="96" y2="58" />
  <line x1="71" y1="61" x2="99" y2="61" />
  <line x1="75" y1="65" x2="103" y2="65" />
  <line x1="80" y1="70" x2="108" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="37" y1="0" x2="108" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 37.94429606029655,0.0 108.5325313544142,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="108" y2="70" style="stroke-width:2" />
  <line x1="80" y1="96" x2="108" y2="96" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="96" style="stroke-width:2" />
  <line x1="108" y1="70" x2="108" y2="96" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 108.5325313544142,70.58823529411765 108.5325313544142,96.00085180870013 80.58823529411765,96.00085180870013" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="94.560383" y="116.000852" font-size="1.0rem" font-weight="100" text-anchor="middle" >720</text>
  <text x="128.532531" y="83.294544" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,128.532531,83.294544)">361</text>
  <text x="35.294118" y="80.706734" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,80.706734)">43832</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-adccedb6-7d96-45e5-becb-42dd1075b188' class='xr-section-summary-in' type='checkbox'  checked><label for='section-adccedb6-7d96-45e5-becb-42dd1075b188' class='xr-section-summary' >Attributes: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>pmsl as a single level variable</dd><dt><span>year :</span></dt><dd>1988</dd><dt><span>source :</span></dt><dd>http://nomads.ncdc.noaa.gov/data.php?name=access#CFSR-data</dd><dt><span>references :</span></dt><dd>Saha, et. al., (2010)</dd><dt><span>created_by :</span></dt><dd>User: kgriffin</dd><dt><span>creation_date :</span></dt><dd>Fri Apr 13 14:12:35 UTC 2012</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>We can see that we have a dataset with</p>
<ul class="simple">
<li><p>1 data variable (<code class="docutils literal notranslate"><span class="pre">pmsl</span></code>)</p></li>
<li><p>1/4 degree lat-lon resolution</p></li>
<li><p>40 pressure levels</p></li>
<li><p>43,832 time elements (that’s 4x daily for 30 years, accounting for leap years!)</p></li>
</ul>
<p>And of course we can (and will) repeat this procedure for each of the variables in our list.</p>
</section>
<section id="dask-and-lazy-execution">
<h3>Dask and lazy execution<a class="headerlink" href="#dask-and-lazy-execution" title="Permalink to this headline">#</a></h3>
<p>Note that we’ve just loaded in handles to a LOT of data. Each 4-dimensional field (lat,lon,pressure,time) is roughly <span class="math notranslate nohighlight">\(4.6 \times 10^{11}\)</span> data points, which at single-precision floating point storage works out to about 1.7 TB!</p>
<p>The total size of this 30-year dataset is about 22 TB.</p>
<p>How does this work? We definitely do not have 22 TB of available memory on this system!</p>
<p>This is an example of “lazy execution”. We have not actually read all that data off of disk. All we have done is read the metadata to effectively create a map of the dataset so that Xarray knows which computations should be valid on this dataset.</p>
</section>
</section>
<section id="creating-the-seasonal-climatology">
<h2>Creating the seasonal climatology<a class="headerlink" href="#creating-the-seasonal-climatology" title="Permalink to this headline">#</a></h2>
<p>Now let’s get started on <em>reducing</em> this dataset into a form more amenable to our analysis. We are going to take <em>time averages</em> over individual seasons.</p>
<section id="grouping-by-season">
<h3>Grouping by season<a class="headerlink" href="#grouping-by-season" title="Permalink to this headline">#</a></h3>
<p>Our time access already understands meteorological seasons DJF (December, January, February), JJA (June, July, August), etc. So creating groups for the four seasons is very simple. Here’s a quick example of using a <code class="docutils literal notranslate"><span class="pre">groupby</span></code> operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmsl_6hourly</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pmsl_6hourly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatasetGroupBy, grouped over &#39;season&#39;
4 groups with labels &#39;DJF&#39;, &#39;JJA&#39;, &#39;MAM&#39;, &#39;SON&#39;.
</pre></div>
</div>
</div>
</div>
</section>
<section id="definining-the-climatology">
<h3>Definining the climatology<a class="headerlink" href="#definining-the-climatology" title="Permalink to this headline">#</a></h3>
<p>We use a grouped operation to take averages over all data points within each season.</p>
<p><em>Note, this operation is very fast because no actualy computations are being done at this point, just laying out a map for <strong>how to do the computations</strong>.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmsl_seas_clim</span> <span class="o">=</span> <span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pmsl_6hourly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">pmsl_seas_clim</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (lat: 361, lon: 720, season: 4)
Coordinates:
  * lat      (lat) float32 -90.0 -89.5 -89.0 -88.5 -88.0 ... 88.5 89.0 89.5 90.0
  * lon      (lon) float32 -180.0 -179.5 -179.0 -178.5 ... 178.5 179.0 179.5
  * season   (season) object &#x27;DJF&#x27; &#x27;JJA&#x27; &#x27;MAM&#x27; &#x27;SON&#x27;
Data variables:
    pmsl     (season, lat, lon) float32 dask.array&lt;chunksize=(1, 361, 720), meta=np.ndarray&gt;</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-21d1aa14-c109-4217-8287-17e367218a7b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-21d1aa14-c109-4217-8287-17e367218a7b' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 361</li><li><span class='xr-has-index'>lon</span>: 720</li><li><span class='xr-has-index'>season</span>: 4</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-34c93227-07b8-439e-95c9-28b1692d00d3' class='xr-section-summary-in' type='checkbox'  checked><label for='section-34c93227-07b8-439e-95c9-28b1692d00d3' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-90.0 -89.5 -89.0 ... 89.5 90.0</div><input id='attrs-5c223a07-7acf-405e-8503-0bea643f0ff8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5c223a07-7acf-405e-8503-0bea643f0ff8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-87572655-0656-4eab-8f55-1d7563cc7b77' class='xr-var-data-in' type='checkbox'><label for='data-87572655-0656-4eab-8f55-1d7563cc7b77' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-90  90]</dd><dt><span>delta_y :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([-90. , -89.5, -89. , ...,  89. ,  89.5,  90. ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -179.5 ... 179.0 179.5</div><input id='attrs-b6fb45fb-c9da-4194-b79a-a58e07c92abd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b6fb45fb-c9da-4194-b79a-a58e07c92abd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-af67392a-e78f-493d-ab71-e05f910c5ee8' class='xr-var-data-in' type='checkbox'><label for='data-af67392a-e78f-493d-ab71-e05f910c5ee8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-180.   179.5]</dd><dt><span>delta_x :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-180. , -179.5, -179. , ...,  178.5,  179. ,  179.5], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>season</span></div><div class='xr-var-dims'>(season)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;DJF&#x27; &#x27;JJA&#x27; &#x27;MAM&#x27; &#x27;SON&#x27;</div><input id='attrs-a7c9aa0d-e5ea-4ca1-902b-27ff3358d8bc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a7c9aa0d-e5ea-4ca1-902b-27ff3358d8bc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bec02460-5418-4dc8-b487-f1c44e04ee65' class='xr-var-data-in' type='checkbox'><label for='data-bec02460-5418-4dc8-b487-f1c44e04ee65' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;DJF&#x27;, &#x27;JJA&#x27;, &#x27;MAM&#x27;, &#x27;SON&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6fed4d6b-0197-4430-a53f-5af1757abaf6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6fed4d6b-0197-4430-a53f-5af1757abaf6' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>pmsl</span></div><div class='xr-var-dims'>(season, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(1, 361, 720), meta=np.ndarray&gt;</div><input id='attrs-8b9b42b1-ec18-492c-88c6-f40fddaa06f1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8b9b42b1-ec18-492c-88c6-f40fddaa06f1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e9280c3d-789a-40ae-b22e-f8d97c4930bf' class='xr-var-data-in' type='checkbox'><label for='data-e9280c3d-789a-40ae-b22e-f8d97c4930bf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 3.97 MiB </td>
                        <td> 0.99 MiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (4, 361, 720) </td>
                        <td> (1, 361, 720) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 382 Tasks </td>
                        <td> 4 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="194" height="125" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="10" y1="60" x2="24" y2="75" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="60" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="63" />
  <line x1="17" y1="7" x2="17" y2="67" />
  <line x1="21" y1="11" x2="21" y2="71" />
  <line x1="24" y1="14" x2="24" y2="75" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 24.9485979497544,14.948597949754403 24.9485979497544,75.11526461642106 10.0,60.16666666666666" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="133" y2="3" />
  <line x1="17" y1="7" x2="137" y2="7" />
  <line x1="21" y1="11" x2="141" y2="11" />
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="130" y1="0" x2="144" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 144.9485979497544,14.948597949754403 24.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />
  <line x1="24" y1="75" x2="144" y2="75" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="24" y1="14" x2="24" y2="75" style="stroke-width:2" />
  <line x1="144" y1="14" x2="144" y2="75" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="24.9485979497544,14.948597949754403 144.9485979497544,14.948597949754403 144.9485979497544,75.11526461642106 24.9485979497544,75.11526461642106" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="84.948598" y="95.115265" font-size="1.0rem" font-weight="100" text-anchor="middle" >720</text>
  <text x="164.948598" y="45.031931" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,164.948598,45.031931)">361</text>
  <text x="7.474299" y="87.640966" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.474299,87.640966)">4</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-4b0c265b-4ef9-4a9b-8931-7b2c98abb428' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-4b0c265b-4ef9-4a9b-8931-7b2c98abb428' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<p>Now we can see that the resulting dataset has a <code class="docutils literal notranslate"><span class="pre">seasons</span></code> axis with our four seasons ‘DJF’, ‘MAM’, ‘JJA’, ‘SON’.</p>
<p><em>With this time averaging, we have reduced the data from 22 TB down to about 2 GB.</em></p>
<p>Our task is now to save the reduced dataset to disk, so that we can do our analyses on data that fits much more comfortably into memory.</p>
<p><em>Now comes all the heavy lifting.</em> In order to save the climatology to disk, we have to actually carry out the computations. This part will be very slow.</p>
</section>
</section>
<section id="saving-the-climatology-to-disk">
<h2>Saving the climatology to disk<a class="headerlink" href="#saving-the-climatology-to-disk" title="Permalink to this headline">#</a></h2>
<p>The code is extremely simple to write, but the execution will be very slow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmsl_seas_clim</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;/nfs/roselab_rit/data/cfsr_climatology/pmsl.seas_clim.0p5.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="doing-it-all-again">
<h2>Doing it all again<a class="headerlink" href="#doing-it-all-again" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="n">pwat_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;pwat&#39;</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span><span class="mi">2018</span><span class="p">):</span>  <span class="c1"># choosing years 1988 through 2017 because there is some missing data after 2017</span>
    <span class="c1">#for var in variables:</span>
    <span class="n">pwat_filepath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;.0p5.anl.nc&#39;</span>
    <span class="n">pwat_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pwat_filepath</span><span class="p">)</span>
<span class="n">pwat_6hourly</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">pwat_files</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pwat_seas_clim</span> <span class="o">=</span> <span class="n">pwat_6hourly</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pwat_6hourly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">pwat_seas_clim</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;/nfs/roselab_rit/data/cfsr_climatology/pwat.seas_clim.0p5.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="n">t_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span><span class="mi">2018</span><span class="p">):</span>  <span class="c1"># choosing years 1988 through 2017 because there is some missing data after 2017</span>
    <span class="c1">#for var in variables:</span>
    <span class="n">t_filepath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;.0p5.anl.nc&#39;</span>
    <span class="n">t_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_filepath</span><span class="p">)</span>
<span class="n">t_6hourly</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">t_files</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Here we select just one pressure level</span>
<span class="n">t1000_seas_clim</span> <span class="o">=</span> <span class="n">t_6hourly</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lev</span><span class="o">=</span><span class="mf">1000.</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">t_6hourly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">t1000_seas_clim</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;/nfs/roselab_rit/data/cfsr_climatology/t1000.seas_clim.0p5.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "aug22"
        },
        kernelOptions: {
            kernelName: "aug22",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'aug22'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="radiation-budget.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1. </span>Earth’s radiation budget</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="observed-circulation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>The observed circulation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Brian E. J. Rose<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>