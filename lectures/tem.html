

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>9. Effect of eddies on the zonal mean circulation &#8212; ATM 622: General Circulation of the Atmosphere</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/tem';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Top-of-Atmosphere Radiation Budget and Meridional Energy Transport" href="../assignments/assignment-toa-budget.html" />
    <link rel="prev" title="8. Theories of the Hadley circulation" href="hadley.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../home.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../home.html">
                    ATM 622: General Circulation of the Atmosphere
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../info/syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info/schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info/how-to.html">How to use this book</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="radiation-budget.html">1. Earth’s radiation budget</a></li>
<li class="toctree-l1"><a class="reference internal" href="computing-seasonal.html">2. Computing seasonal and monthly means from CFSR data</a></li>
<li class="toctree-l1"><a class="reference internal" href="observed-circulation.html">3. The observed circulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="decomposing-circulation.html">4. Decompositions of the circulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="angular-momentum-budget.html">5. Angular Momentum Budget</a></li>
<li class="toctree-l1"><a class="reference internal" href="energy-budget.html">6. Energy Budget</a></li>
<li class="toctree-l1"><a class="reference internal" href="ape.html">7. Available Potential Energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="hadley.html">8. Theories of the Hadley circulation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">9. Effect of eddies on the zonal mean circulation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments and labs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../assignments/assignment-toa-budget.html">1. Top-of-Atmosphere Radiation Budget and Meridional Energy Transport</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The stuff at the end</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../info/dask_test.html">Benchmarking a data-intensive operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info/dask_test_snow.html">Benchmarking a data-intensive operation (snow version)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info/references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://lore.atmos.albany.edu:8000/hub/user-redirect/git-pull?repo=https%3A//github.com/brian-rose/general-circulation&urlpath=lab/tree/general-circulation/./lectures/tem.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/brian-rose/general-circulation" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/brian-rose/general-circulation/issues/new?title=Issue%20on%20page%20%2Flectures/tem.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/tem.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Effect of eddies on the zonal mean circulation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-transformed-eulerian-mean-tem-or-residual-circulation">The Transformed Eulerian Mean (TEM) or “Residual Circulation”</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-residual-overturning-required-by-diabatic-heating">The residual overturning required by diabatic heating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acceleration-of-the-zonal-mean-wind">Acceleration of the zonal mean wind</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-eliassen-palm-flux-vector">The Eliassen-Palm flux vector</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-potential-vorticity-perspective">A potential vorticity perspective</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-idea">The idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zonal-average-qgpv-equation">Zonal average QGPV equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-perspective-on-the-steady-balanced-circulation">A perspective on the steady, balanced circulation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tem-equations-for-the-atmosphere">TEM equations for the atmosphere</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ep-flux-vector-components-for-the-atmosphere">The EP flux vector components for the atmosphere</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complete-set-of-tem-equations-for-the-atmosphere">Complete set of TEM equations for the atmosphere</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-residual-mean-for-the-atmosphere">The residual mean for the atmosphere</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-angular-momentum-equation">An angular momentum equation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-eliassen-palm-cross-section-from-reanalysis-data">Plotting the Eliassen-Palm cross-section from reanalysis data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-classic-figure">The classic figure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-cfsr-data-and-get-to-work">Load the CFSR data and get to work</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#heat-flux">Heat flux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#momentum-flux">Momentum flux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stratification">Stratification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rescaled-hat-components">The rescaled “hat” components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-ep-flux-diagram">Plotting the EP flux diagram</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-ep-flux-diagram">Interpreting the EP flux diagram</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concluding-remarks-about-the-eliassen-palm-flux-plots">Concluding remarks about the Eliassen-Palm flux plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-residual-mean-overturning">The residual mean overturning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">The idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formulas">Formulas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-eulerian-mean-streamfunction">Compute Eulerian mean streamfunction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-residual-using-eddy-heat-flux-correction">Compute residual using eddy heat flux correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-residual-streamfunction-and-compare-to-eulerian-mean">Plot the residual streamfunction and compare to Eulerian mean</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="effect-of-eddies-on-the-zonal-mean-circulation">
<h1><span class="section-number">9. </span>Effect of eddies on the zonal mean circulation<a class="headerlink" href="#effect-of-eddies-on-the-zonal-mean-circulation" title="Permalink to this heading">#</a></h1>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this heading">#</a></h2>
<p>We saw at the <a class="reference external" href="https://brian-rose.github.io/general-circulation/lectures/hadley.html#effects-of-eddies-on-the-hadley-cell-qualitative-and-diagnostic-arguments">end of the last set of notes</a> that both eddy momentum fluxes and eddy heat (buoyancy) fluxes are both involved in determing the zonal-mean flow:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial [u]}{\partial t} &amp;= f[v] -\frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} ([u^*v^*] \cos\phi) \\
\frac{\partial [b]}{\partial t} &amp;= -N^2 [w] -\frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} ( [v^* b^*] \cos\phi ) + \dot{Q} 
\end{align*}\]</div>
<p>Let’s consider the effects of an eddy heat flux on a frictionless, adiabatic system (<span class="math notranslate nohighlight">\(\dot{Q} = 0\)</span>).</p>
<p>At steady state, the thermodynamic equation tells us that we must have an Eulerian mean overturning circulation with vertical component</p>
<div class="math notranslate nohighlight">
\[ [w] = -\frac{1}{a\cos\phi N^2} \frac{\partial}{\partial \phi} ( [v^* b^*] \cos\phi ) \]</div>
<p>which in turn, by mass conservation, requires a horizontal component of the overturning <span class="math notranslate nohighlight">\([v]\)</span>.</p>
<p>But <span class="math notranslate nohighlight">\([v]\)</span> enters into the momentum equation through the Coriolis force.</p>
<p>So, <em>eddy heat fluxes must <strong>accelerate</strong> the zonal mean zonal wind <span class="math notranslate nohighlight">\([u]\)</span> through Coriolis forces associated with the overturning circulation</em>. Eddy heat fluxes appear in the zonal mean momentum equation disguised as Coriolis force.</p>
<p>Are you confused yet?</p>
<p>Maybe there’s a better way to express the <strong>combined effect of eddy heat and momentum fluxes</strong> that clarify under what conditions the eddies can accelerate the mean zonal flow <span class="math notranslate nohighlight">\([u]\)</span>.</p>
<p>[Related, we’ve also seen that the <a class="reference external" href="https://brian-rose.github.io/general-circulation/lectures/ape.html#diagram-of-the-lorenz-energy-cycle">Lorenz cycle</a> reveals substantial conversion from eddy kinetic energy to kinetic energy of the mean flow]</p>
<p>Along the way, we may also find a better way to think about the overturning circulation in a flow dominated by eddies.</p>
</section>
<section id="the-transformed-eulerian-mean-tem-or-residual-circulation">
<h2>The Transformed Eulerian Mean (TEM) or “Residual Circulation”<a class="headerlink" href="#the-transformed-eulerian-mean-tem-or-residual-circulation" title="Permalink to this heading">#</a></h2>
<section id="the-residual-overturning-required-by-diabatic-heating">
<h3>The residual overturning required by diabatic heating<a class="headerlink" href="#the-residual-overturning-required-by-diabatic-heating" title="Permalink to this heading">#</a></h3>
<p>Define a “residual” vertical motion <span class="math notranslate nohighlight">\(w_{res}\)</span> as the direct response to diabatic heating, accounting for the large cancellation between eddy heat flux convergence and adiabatic ascent:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial [b]}{\partial t} = -N^2 w_{res} + \dot{Q} \]</div>
<p>where we have just wrapped the eddy heat flux term into <span class="math notranslate nohighlight">\(w_{res}\)</span>:</p>
<div class="math notranslate nohighlight">
\[ w_{res} = [w] + \frac{1}{a\cos\phi N^2} \frac{\partial}{\partial \phi} ( [v^* b^*] \cos\phi ) \]</div>
<p>So far, just clever notation.</p>
<p>Now, let’s define the horizonal component of the residual overturning <span class="math notranslate nohighlight">\(v_{res}\)</span> to obey mass continuity:</p>
<div class="math notranslate nohighlight">
\[ \frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} \left( v_{res} \cos\phi \right) + \frac{\partial}{\partial z} w_{res} = 0 \]</div>
<p>So between <span class="math notranslate nohighlight">\(v_{res}\)</span> and the Eulerian mean <span class="math notranslate nohighlight">\([v]\)</span> must be</p>
<div class="math notranslate nohighlight">
\[ v_{res} = [v] - \frac{\partial}{\partial z} \left( \frac{[v^* b^*]}{N^2}  \right)\]</div>
<p>Together <span class="math notranslate nohighlight">\(v_{res}, w_{res}\)</span> describe a residual overturning circulation specifically required by the diabatic heating!</p>
</section>
<section id="acceleration-of-the-zonal-mean-wind">
<h3>Acceleration of the zonal mean wind<a class="headerlink" href="#acceleration-of-the-zonal-mean-wind" title="Permalink to this heading">#</a></h3>
<p>Now let’s use this to rewrite the momentum equation in terms of the Coriolis force due to <span class="math notranslate nohighlight">\(v_{res}\)</span>:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial [u]}{\partial t} &amp;= f[v] -\frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} ([u^*v^*] \cos\phi) \\
&amp;= f\left( v_{res} +  \frac{\partial}{\partial z} \left( \frac{[v^* b^*]}{N^2}  \right) \right) -\frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} ([u^*v^*] \cos\phi)
\end{align*}\]</div>
<p>or, rewriting with only eddy forcing terms on the RHS:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial [u]}{\partial t} - f v_{res} = -\frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} ([u^*v^*] \cos\phi) + f \frac{\partial}{\partial z} \left( \frac{[v^* b^*]}{N^2}  \right) \]</div>
<p>This is actually a deep result. <span class="math notranslate nohighlight">\(v_{res}\)</span> is determined entirely by the zonal diabatic heating, regardless of what the eddies are doing. Our transformed momentum equation tells that there’s a very specific combination of eddy heat and momemtum fluxes that accelerate the zonal mean wind.</p>
<p>The transformed equation no longer has any “hidden” eddy effects – it expresses more completely how the eddies drive the mean flow.</p>
</section>
<section id="the-eliassen-palm-flux-vector">
<h3>The Eliassen-Palm flux vector<a class="headerlink" href="#the-eliassen-palm-flux-vector" title="Permalink to this heading">#</a></h3>
<p>It’s useful and traditional to define a vector <span class="math notranslate nohighlight">\(\vec{F}\)</span> (in the latitude-height plane) whose divergence appears on the RHS of the momentum equation. That is, we want to write the Transformed Eulerian Mean system like this:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial [u]}{\partial t} - f v_{res} &amp;= \nabla \cdot \vec{F} \\
\frac{\partial [b]}{\partial t} &amp;= -N^2 w_{res} + \dot{Q} 
\end{align*}\]</div>
<p>From the transformed momentum equation above, we can see that</p>
<ul class="simple">
<li><p>the vertical component of <span class="math notranslate nohighlight">\(\vec{F}\)</span> must be propotional to eddy heat flux</p></li>
<li><p>the horizontal component of <span class="math notranslate nohighlight">\(\vec{F}\)</span> must be proportional to eddy momentum flux (but in reverse direction)</p></li>
</ul>
<p>More precisely, we can define <span class="math notranslate nohighlight">\(\vec{F}\)</span> for this system like this:</p>
<div class="math notranslate nohighlight">
\[ \vec{F} = -[u^* v^*] \hat{j} + \frac{f}{N^2} [v^* b^*] \hat{k} \]</div>
<p>The vector <span class="math notranslate nohighlight">\(\vec{F}\)</span> is called the Eliassen-Palm flux, after a pioneering paper by <span id="id1">Eliassen and Palm [<a class="reference internal" href="../info/references.html#id17" title="Arnt Eliassen and Enok Palm. On the transfer of energy in stationary mountain waves. Geofysiske Publikasjoner, 22(3):1–23, 1961.">1961</a>]</span>.</p>
</section>
</section>
<section id="a-potential-vorticity-perspective">
<h2>A potential vorticity perspective<a class="headerlink" href="#a-potential-vorticity-perspective" title="Permalink to this heading">#</a></h2>
<section id="the-idea">
<h3>The idea<a class="headerlink" href="#the-idea" title="Permalink to this heading">#</a></h3>
<p>We’ve been talking about combining momentum and thermodynamic constraints together into a single quantity <span class="math notranslate nohighlight">\(\vec{F}\)</span>. That may sound familiar.</p>
<p>Recall that under the Quasi-Geostrophic approximation, we boil down all the dynamics into a single prognostic scalar, the quasi-geostrophic potential vorticity (QGPV).  We might therefore expect a deep relationship between PV dynamics and the Eliassen-Palm flux <span class="math notranslate nohighlight">\(\vec{F}\)</span>.</p>
<p>And there is!</p>
</section>
<section id="zonal-average-qgpv-equation">
<h3>Zonal average QGPV equation<a class="headerlink" href="#zonal-average-qgpv-equation" title="Permalink to this heading">#</a></h3>
<p>Let’s write</p>
<p>[Need to fill in details here]</p>
<p>The key result</p>
<div class="math notranslate nohighlight">
\[[v^*q^*] = \nabla \cdot \vec{F} \]</div>
<p>The divergence of the EP flux (which is a specific combination of eddy heat and momentum fluxes) is equivalent to a northward eddy flux of QGPV!</p>
<p>So another form of the TEM equations is (under the quasi-geostrophic approximation):</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial [u]}{\partial t} - f v_{res} &amp;= [v^* q^*] \\
\frac{\partial [b]}{\partial t} &amp;= -N^2 w_{res} + \dot{Q} 
\end{align*}\]</div>
</section>
<section id="a-perspective-on-the-steady-balanced-circulation">
<h3>A perspective on the steady, balanced circulation<a class="headerlink" href="#a-perspective-on-the-steady-balanced-circulation" title="Permalink to this heading">#</a></h3>
<p>For a balanced time-mean flow, our TEM equations thus say</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
 - f v_{res} &amp;= [v^* q^*] \\
N^2 w_{res} &amp;=  \dot{Q} 
\end{align*}\]</div>
<p>Now consider the fact that the diabatic heating tends to decrease from equator to pole. So <span class="math notranslate nohighlight">\(w_[res]\)</span> might be upward near the equator and downward near the pole.</p>
<p>We infer from this that <span class="math notranslate nohighlight">\(v_{res}\)</span> must be poleward aloft (to conserve mass) – i.e. <span class="math notranslate nohighlight">\(v_{res} &gt; 0\)</span>. The residual circulation should look something like a big equator-to-pole scale Hadley cell!</p>
<p>But this poleward residual circulation applies an <em>eastward</em> Coriolis force on the zonal wind. To have a steady balance, the eddies must be arranged to produce an equal and opposite <em>westward</em> force.</p>
<p>We can infer from this that the eddies must be fluxing QGPV <em>equatorward</em>, i.e. <span class="math notranslate nohighlight">\([v^* q^*] &lt; 0\)</span></p>
<p>Since the planetary PV increases toward the poles, the eddies are thus flux PV down the mean gradient. Unlike for momentum, the eddies behave diffusively in the PV framework – acting to transport PV from the high reservoir near the poles to the low reservoir near the equator.</p>
</section>
</section>
<section id="tem-equations-for-the-atmosphere">
<h2>TEM equations for the atmosphere<a class="headerlink" href="#tem-equations-for-the-atmosphere" title="Permalink to this heading">#</a></h2>
<p>The theory and diagnostic method are laid out in a well-known paper by <span id="id2">Edmon Jr. <em>et al.</em> [<a class="reference internal" href="../info/references.html#id16" title="H. J. Edmon Jr., B.J. Hoskins, and M.E. McIntyre. Eliassen-Palm cross sections for the troposphere. J. Atmos. Sci., 37:2600–2616, 1980. doi:10.1175/1520-0469(1980)037&lt;2600:EPCSFT&gt;2.0.CO;2.">1980</a>]</span>.</p>
<section id="the-ep-flux-vector-components-for-the-atmosphere">
<h3>The EP flux vector components for the atmosphere<a class="headerlink" href="#the-ep-flux-vector-components-for-the-atmosphere" title="Permalink to this heading">#</a></h3>
<p>The appropriate definitions for the components of <span class="math notranslate nohighlight">\(\vec{F}\)</span> are</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_\phi &amp;= -a \cos\phi [u^* v^*] \\
F_p &amp;= f a \cos\phi \frac{[v^* \theta^*]}{\sigma}
\end{align*}\]</div>
<p>where we now use pressure coordinates, measure buoyancy using potential temperature <span class="math notranslate nohighlight">\(\theta\)</span>, and we have defined a stratification parameter</p>
<div class="math notranslate nohighlight">
\[ \sigma \equiv \frac{\partial [\theta]}{\partial p} \]</div>
<p><em>Note that <span class="math notranslate nohighlight">\(\sigma&lt;0\)</span> for statically stable conditions since <span class="math notranslate nohighlight">\(\theta\)</span> increases upward.</em></p>
</section>
<section id="complete-set-of-tem-equations-for-the-atmosphere">
<h3>Complete set of TEM equations for the atmosphere<a class="headerlink" href="#complete-set-of-tem-equations-for-the-atmosphere" title="Permalink to this heading">#</a></h3>
<p>TEM equations for the atmosphere on a sphere look like</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial [u]}{\partial t} - f v_{res} &amp;= \frac{1}{a \cos\phi} \nabla \cdot \vec{F} \\
f \frac{\partial [u]}{p} - \frac{R}{a} \frac{\partial [\theta]}{\partial \phi} &amp;= 0\\
\frac{\partial [\theta]}{\partial t} + \sigma \omega_{res} &amp;= \dot{Q} \\
\frac{1}{a \cos\phi} \frac{\partial}{\partial \phi} \left( v_{res} \cos\phi \right) + \frac{\partial \omega_{res}}{\partial p} &amp;= 0 
\end{align*}\]</div>
</section>
<section id="the-residual-mean-for-the-atmosphere">
<h3>The residual mean for the atmosphere<a class="headerlink" href="#the-residual-mean-for-the-atmosphere" title="Permalink to this heading">#</a></h3>
<p>Definitions for <span class="math notranslate nohighlight">\(v_{res}\)</span> and <span class="math notranslate nohighlight">\(\omega_{res}\)</span> consistent with the above equations are</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
v_{res} &amp;= [v] - \frac{\partial}{\partial p} \left( \frac{ [v^*\theta^*]}{\sigma} \right) \\
\omega_{res} &amp;= [\omega] _ \frac{1}{a\cos\phi} \frac{\partial}{\partial \phi} \left( \frac{[v^* \theta^*] \cos\phi}{\sigma} \right) 
\end{align*}\]</div>
</section>
<section id="an-angular-momentum-equation">
<h3>An angular momentum equation<a class="headerlink" href="#an-angular-momentum-equation" title="Permalink to this heading">#</a></h3>
<p>The Eulerian mean angular momentum <span class="math notranslate nohighlight">\([M]\)</span> is</p>
<div class="math notranslate nohighlight">
\[[M] = \Omega a^2 \cos^2\phi + [u] a \cos\phi\]</div>
<p>so the transformed zonal momentum equation can also be expressed in terms of angular momentum as</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial [M]}{\partial t} + \frac{v_{res}}{a} \frac{\partial M}{\partial \phi} = \nabla \cdot \vec{F} \]</div>
<p>to quasi-geostrophic order.</p>
<p>This form shows that the divergence of the EP flux is a direct eddy forcing on the zonal mean angular momentum – a torque on the atmosphere!</p>
</section>
</section>
<section id="plotting-the-eliassen-palm-cross-section-from-reanalysis-data">
<h2>Plotting the Eliassen-Palm cross-section from reanalysis data<a class="headerlink" href="#plotting-the-eliassen-palm-cross-section-from-reanalysis-data" title="Permalink to this heading">#</a></h2>
<section id="the-classic-figure">
<h3>The classic figure<a class="headerlink" href="#the-classic-figure" title="Permalink to this heading">#</a></h3>
<p>We are going to make an updated version of this famous figure showing <span class="math notranslate nohighlight">\(\vec{F}\)</span> and its divergence:</p>
<figure class="align-default" id="markdown-fig">
<a class="reference internal image-reference" href="../_images/Edmon_Fig5.pdf"><img alt="Eliassen-Palm cross-section" src="../_images/Edmon_Fig5.pdf" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 9.1 </span><span class="caption-text">Source: <span id="id3">Edmon Jr. <em>et al.</em> [<a class="reference internal" href="../info/references.html#id16" title="H. J. Edmon Jr., B.J. Hoskins, and M.E. McIntyre. Eliassen-Palm cross sections for the troposphere. J. Atmos. Sci., 37:2600–2616, 1980. doi:10.1175/1520-0469(1980)037&lt;2600:EPCSFT&gt;2.0.CO;2.">1980</a>]</span> (Their Figure 5).</span><a class="headerlink" href="#markdown-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="load-the-cfsr-data-and-get-to-work">
<h3>Load the CFSR data and get to work<a class="headerlink" href="#load-the-cfsr-data-and-get-to-work" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask_jobqueue</span> <span class="kn">import</span> <span class="n">SLURMCluster</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">SLURMCluster</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1">#By default Dask will run one Python process per job. </span>
                       <span class="c1"># However, you can optionally choose to cut up that job into multiple processes</span>
                       <span class="n">cores</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="c1"># size of a single job -- typically one node of the HPC cluster</span>
                       <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;376.2GB&quot;</span><span class="p">,</span>  <span class="c1"># the max memory on the 80-core batch nodes, I believe</span>
                       <span class="n">walltime</span><span class="o">=</span><span class="s2">&quot;04:00:00&quot;</span><span class="p">,</span>
                       <span class="n">queue</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
                      <span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-aaeebc78-70b7-11ed-869b-80000086fe80</p>
        <table style="width: 100%; text-align: left;">

        <tr>
        
            <td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
            <td style="text-align: left;"><strong>Cluster type:</strong> dask_jobqueue.SLURMCluster</td>
        
        </tr>

        
            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard: </strong> <a href="http://169.226.65.158:8787/status" target="_blank">http://169.226.65.158:8787/status</a>
                </td>
                <td style="text-align: left;"></td>
            </tr>
        

        </table>

        
            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;">SLURMCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">e77de491</p>
        <table style="width: 100%; text-align: left;">
            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard:</strong> <a href="http://169.226.65.158:8787/status" target="_blank">http://169.226.65.158:8787/status</a>
                </td>
                <td style="text-align: left;">
                    <strong>Workers:</strong> 0
                </td>
            </tr>
            <tr>
                <td style="text-align: left;">
                    <strong>Total threads:</strong> 0
                </td>
                <td style="text-align: left;">
                    <strong>Total memory:</strong> 0 B
                </td>
            </tr>
            
        </table>

        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-aec1f46e-da36-4d03-9908-b59094d37589</p>
            <table style="width: 100%; text-align: left;">
                <tr>
                    <td style="text-align: left;">
                        <strong>Comm:</strong> tcp://169.226.65.158:46245
                    </td>
                    <td style="text-align: left;">
                        <strong>Workers:</strong> 0
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Dashboard:</strong> <a href="http://169.226.65.158:8787/status" target="_blank">http://169.226.65.158:8787/status</a>
                    </td>
                    <td style="text-align: left;">
                        <strong>Total threads:</strong> 0
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Started:</strong> Just now
                    </td>
                    <td style="text-align: left;">
                        <strong>Total memory:</strong> 0 B
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;">Workers</h3>
        </summary>

        

    </details>
</div>

        </details>
    </div>
</div>
            </details>
        

    </div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span><span class="mi">2018</span><span class="p">)</span>  <span class="c1"># Ten years of data 2008 through 2017</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">]</span>
<span class="n">path_to_cfsr_data</span> <span class="o">=</span> <span class="s1">&#39;/network/daes/cfsr/data/&#39;</span>
<span class="n">ending</span> <span class="o">=</span> <span class="s1">&#39;.0p5.anl.nc&#39;</span>

<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">path_to_cfsr_data</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="n">ending</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cfsr_6hourly</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;lev&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">})</span>
<span class="n">cfsr_6hourly</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (time: 14612, lev: 32, lat: 361, lon: 720)
Coordinates:
  * time     (time) datetime64[ns] 2008-01-01 ... 2017-12-31T18:00:00
  * lev      (lev) float32 1e+03 975.0 950.0 925.0 900.0 ... 50.0 30.0 20.0 10.0
  * lat      (lat) float32 -90.0 -89.5 -89.0 -88.5 -88.0 ... 88.5 89.0 89.5 90.0
  * lon      (lon) float32 -180.0 -179.5 -179.0 -178.5 ... 178.5 179.0 179.5
Data variables:
    t        (time, lev, lat, lon) float32 dask.array&lt;chunksize=(10, 32, 361, 720), meta=np.ndarray&gt;
    u        (time, lev, lat, lon) float32 dask.array&lt;chunksize=(10, 32, 361, 720), meta=np.ndarray&gt;
    v        (time, lev, lat, lon) float32 dask.array&lt;chunksize=(10, 32, 361, 720), meta=np.ndarray&gt;
Attributes:
    description:    t 1000-10 hPa
    year:           2008
    source:         http://nomads.ncdc.noaa.gov/data.php?name=access#CFSR-data
    references:     Saha, et. al., (2010)
    creation_date:  Tue Feb 28 21:29:31 UTC 2012</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a6f05960-5883-48ec-831b-10569dad27a8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a6f05960-5883-48ec-831b-10569dad27a8' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 14612</li><li><span class='xr-has-index'>lev</span>: 32</li><li><span class='xr-has-index'>lat</span>: 361</li><li><span class='xr-has-index'>lon</span>: 720</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-9d4b1c84-2802-4beb-ae2a-8d0341902258' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9d4b1c84-2802-4beb-ae2a-8d0341902258' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2008-01-01 ... 2017-12-31T18:00:00</div><input id='attrs-c0a2d82f-3b06-4743-8680-fd7ae802301a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c0a2d82f-3b06-4743-8680-fd7ae802301a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fbec1a60-467c-47dc-9cd9-e4e7a6d254af' class='xr-var-data-in' type='checkbox'><label for='data-fbec1a60-467c-47dc-9cd9-e4e7a6d254af' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[1823280. 1832058.]</dd><dt><span>last_time :</span></dt><dd>2008-12-31 18:00:00</dd><dt><span>first_time :</span></dt><dd>2008-1-1 00:00:00</dd><dt><span>delta_t :</span></dt><dd>0000-00-00 06:00:00</dd><dt><span>long_name :</span></dt><dd>initial time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;2008-01-01T00:00:00.000000000&#x27;, &#x27;2008-01-01T06:00:00.000000000&#x27;,
       &#x27;2008-01-01T12:00:00.000000000&#x27;, ..., &#x27;2017-12-31T06:00:00.000000000&#x27;,
       &#x27;2017-12-31T12:00:00.000000000&#x27;, &#x27;2017-12-31T18:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lev</span></div><div class='xr-var-dims'>(lev)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1e+03 975.0 950.0 ... 20.0 10.0</div><input id='attrs-2606219d-ebcd-423f-ad16-edc72b42933a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2606219d-ebcd-423f-ad16-edc72b42933a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-65919c0e-107e-4138-959e-9b856ab6848e' class='xr-var-data-in' type='checkbox'><label for='data-65919c0e-107e-4138-959e-9b856ab6848e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>hPa</dd><dt><span>long_name :</span></dt><dd>isobaric_level</dd></dl></div><div class='xr-var-data'><pre>array([1000.,  975.,  950.,  925.,  900.,  875.,  850.,  825.,  800.,  775.,
        750.,  700.,  650.,  600.,  550.,  500.,  450.,  400.,  350.,  300.,
        250.,  225.,  200.,  175.,  150.,  125.,  100.,   70.,   50.,   30.,
         20.,   10.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-90.0 -89.5 -89.0 ... 89.5 90.0</div><input id='attrs-32e7d574-4442-466b-bf92-1780afa377c3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-32e7d574-4442-466b-bf92-1780afa377c3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e0af48ce-113f-4d85-a0d0-ba78e7a5c649' class='xr-var-data-in' type='checkbox'><label for='data-e0af48ce-113f-4d85-a0d0-ba78e7a5c649' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-90  90]</dd><dt><span>delta_y :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([-90. , -89.5, -89. , ...,  89. ,  89.5,  90. ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -179.5 ... 179.0 179.5</div><input id='attrs-04eec0e8-d2b2-477f-83f4-6b025b53ee39' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-04eec0e8-d2b2-477f-83f4-6b025b53ee39' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-15d9ba7f-8279-4a5b-996d-99e700ddb2bd' class='xr-var-data-in' type='checkbox'><label for='data-15d9ba7f-8279-4a5b-996d-99e700ddb2bd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-180.   179.5]</dd><dt><span>delta_x :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-180. , -179.5, -179. , ...,  178.5,  179. ,  179.5], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-90d5c58d-9e0e-4789-8feb-56c89866d162' class='xr-section-summary-in' type='checkbox'  checked><label for='section-90d5c58d-9e0e-4789-8feb-56c89866d162' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>t</span></div><div class='xr-var-dims'>(time, lev, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(10, 32, 361, 720), meta=np.ndarray&gt;</div><input id='attrs-7ebfb2b2-a91b-4082-9ae1-586e66c5ddf2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7ebfb2b2-a91b-4082-9ae1-586e66c5ddf2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8f497dfa-fdd1-400f-bfcd-5ab31d513727' class='xr-var-data-in' type='checkbox'><label for='data-8f497dfa-fdd1-400f-bfcd-5ab31d513727' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>level_type :</span></dt><dd>Isobaric (hPa)</dd><dt><span>units :</span></dt><dd>K</dd><dt><span>long_name :</span></dt><dd>temperature</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 452.75 GiB </td>
                        <td> 317.29 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (14612, 32, 361, 720) </td>
                        <td> (10, 32, 361, 720) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1463 chunks in 21 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="479" height="95" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="3" y1="0" x2="3" y2="25" />
  <line x1="7" y1="0" x2="7" y2="25" />
  <line x1="11" y1="0" x2="11" y2="25" />
  <line x1="14" y1="0" x2="14" y2="25" />
  <line x1="18" y1="0" x2="18" y2="25" />
  <line x1="22" y1="0" x2="22" y2="25" />
  <line x1="26" y1="0" x2="26" y2="25" />
  <line x1="29" y1="0" x2="29" y2="25" />
  <line x1="33" y1="0" x2="33" y2="25" />
  <line x1="37" y1="0" x2="37" y2="25" />
  <line x1="41" y1="0" x2="41" y2="25" />
  <line x1="44" y1="0" x2="44" y2="25" />
  <line x1="48" y1="0" x2="48" y2="25" />
  <line x1="52" y1="0" x2="52" y2="25" />
  <line x1="56" y1="0" x2="56" y2="25" />
  <line x1="59" y1="0" x2="59" y2="25" />
  <line x1="63" y1="0" x2="63" y2="25" />
  <line x1="67" y1="0" x2="67" y2="25" />
  <line x1="71" y1="0" x2="71" y2="25" />
  <line x1="74" y1="0" x2="74" y2="25" />
  <line x1="78" y1="0" x2="78" y2="25" />
  <line x1="82" y1="0" x2="82" y2="25" />
  <line x1="86" y1="0" x2="86" y2="25" />
  <line x1="89" y1="0" x2="89" y2="25" />
  <line x1="93" y1="0" x2="93" y2="25" />
  <line x1="97" y1="0" x2="97" y2="25" />
  <line x1="101" y1="0" x2="101" y2="25" />
  <line x1="105" y1="0" x2="105" y2="25" />
  <line x1="108" y1="0" x2="108" y2="25" />
  <line x1="112" y1="0" x2="112" y2="25" />
  <line x1="116" y1="0" x2="116" y2="25" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >14612</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="204" y2="14" style="stroke-width:2" />
  <line x1="190" y1="30" x2="204" y2="45" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="190" y2="30" style="stroke-width:2" />
  <line x1="204" y1="14" x2="204" y2="45" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 204.9485979497544,14.948597949754403 204.9485979497544,45.190852460757796 190.0,30.242254511003395" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="224" y2="0" style="stroke-width:2" />
  <line x1="204" y1="14" x2="239" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="204" y2="14" style="stroke-width:2" />
  <line x1="224" y1="0" x2="239" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 224.41151127943255,0.0 239.36010922918695,14.948597949754403 204.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="204" y1="14" x2="239" y2="14" style="stroke-width:2" />
  <line x1="204" y1="45" x2="239" y2="45" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="204" y1="14" x2="204" y2="45" style="stroke-width:2" />
  <line x1="239" y1="14" x2="239" y2="45" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="204.9485979497544,14.948597949754403 239.36010922918695,14.948597949754403 239.36010922918695,45.190852460757796 204.9485979497544,45.190852460757796" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="222.154354" y="65.190852" font-size="1.0rem" font-weight="100" text-anchor="middle" >720</text>
  <text x="259.360109" y="30.069725" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,259.360109,30.069725)">361</text>
  <text x="187.474299" y="57.716553" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,187.474299,57.716553)">32</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>u</span></div><div class='xr-var-dims'>(time, lev, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(10, 32, 361, 720), meta=np.ndarray&gt;</div><input id='attrs-a0b101c0-4efb-47d1-b7e1-0736199b2d28' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a0b101c0-4efb-47d1-b7e1-0736199b2d28' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3ff5f2da-431d-4499-9034-89e56d1bcbb5' class='xr-var-data-in' type='checkbox'><label for='data-3ff5f2da-431d-4499-9034-89e56d1bcbb5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>level_type :</span></dt><dd>Isobaric (hPa)</dd><dt><span>units :</span></dt><dd>m s^-1</dd><dt><span>long_name :</span></dt><dd>zonal_wind</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 452.75 GiB </td>
                        <td> 317.29 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (14612, 32, 361, 720) </td>
                        <td> (10, 32, 361, 720) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1463 chunks in 21 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="479" height="95" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="3" y1="0" x2="3" y2="25" />
  <line x1="7" y1="0" x2="7" y2="25" />
  <line x1="11" y1="0" x2="11" y2="25" />
  <line x1="14" y1="0" x2="14" y2="25" />
  <line x1="18" y1="0" x2="18" y2="25" />
  <line x1="22" y1="0" x2="22" y2="25" />
  <line x1="26" y1="0" x2="26" y2="25" />
  <line x1="29" y1="0" x2="29" y2="25" />
  <line x1="33" y1="0" x2="33" y2="25" />
  <line x1="37" y1="0" x2="37" y2="25" />
  <line x1="41" y1="0" x2="41" y2="25" />
  <line x1="44" y1="0" x2="44" y2="25" />
  <line x1="48" y1="0" x2="48" y2="25" />
  <line x1="52" y1="0" x2="52" y2="25" />
  <line x1="56" y1="0" x2="56" y2="25" />
  <line x1="59" y1="0" x2="59" y2="25" />
  <line x1="63" y1="0" x2="63" y2="25" />
  <line x1="67" y1="0" x2="67" y2="25" />
  <line x1="71" y1="0" x2="71" y2="25" />
  <line x1="74" y1="0" x2="74" y2="25" />
  <line x1="78" y1="0" x2="78" y2="25" />
  <line x1="82" y1="0" x2="82" y2="25" />
  <line x1="86" y1="0" x2="86" y2="25" />
  <line x1="89" y1="0" x2="89" y2="25" />
  <line x1="93" y1="0" x2="93" y2="25" />
  <line x1="97" y1="0" x2="97" y2="25" />
  <line x1="101" y1="0" x2="101" y2="25" />
  <line x1="105" y1="0" x2="105" y2="25" />
  <line x1="108" y1="0" x2="108" y2="25" />
  <line x1="112" y1="0" x2="112" y2="25" />
  <line x1="116" y1="0" x2="116" y2="25" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >14612</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="204" y2="14" style="stroke-width:2" />
  <line x1="190" y1="30" x2="204" y2="45" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="190" y2="30" style="stroke-width:2" />
  <line x1="204" y1="14" x2="204" y2="45" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 204.9485979497544,14.948597949754403 204.9485979497544,45.190852460757796 190.0,30.242254511003395" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="224" y2="0" style="stroke-width:2" />
  <line x1="204" y1="14" x2="239" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="204" y2="14" style="stroke-width:2" />
  <line x1="224" y1="0" x2="239" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 224.41151127943255,0.0 239.36010922918695,14.948597949754403 204.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="204" y1="14" x2="239" y2="14" style="stroke-width:2" />
  <line x1="204" y1="45" x2="239" y2="45" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="204" y1="14" x2="204" y2="45" style="stroke-width:2" />
  <line x1="239" y1="14" x2="239" y2="45" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="204.9485979497544,14.948597949754403 239.36010922918695,14.948597949754403 239.36010922918695,45.190852460757796 204.9485979497544,45.190852460757796" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="222.154354" y="65.190852" font-size="1.0rem" font-weight="100" text-anchor="middle" >720</text>
  <text x="259.360109" y="30.069725" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,259.360109,30.069725)">361</text>
  <text x="187.474299" y="57.716553" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,187.474299,57.716553)">32</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v</span></div><div class='xr-var-dims'>(time, lev, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(10, 32, 361, 720), meta=np.ndarray&gt;</div><input id='attrs-a3c3493a-c05b-4214-b37c-92cfc4d5b4c3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a3c3493a-c05b-4214-b37c-92cfc4d5b4c3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e3b7366a-4e65-4ea8-97c7-bdd0f14e3130' class='xr-var-data-in' type='checkbox'><label for='data-e3b7366a-4e65-4ea8-97c7-bdd0f14e3130' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>level_type :</span></dt><dd>Isobaric (hPa)</dd><dt><span>units :</span></dt><dd>m s^-1</dd><dt><span>long_name :</span></dt><dd>meridional_wind</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 452.75 GiB </td>
                        <td> 317.29 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (14612, 32, 361, 720) </td>
                        <td> (10, 32, 361, 720) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1463 chunks in 21 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="479" height="95" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="3" y1="0" x2="3" y2="25" />
  <line x1="7" y1="0" x2="7" y2="25" />
  <line x1="11" y1="0" x2="11" y2="25" />
  <line x1="14" y1="0" x2="14" y2="25" />
  <line x1="18" y1="0" x2="18" y2="25" />
  <line x1="22" y1="0" x2="22" y2="25" />
  <line x1="26" y1="0" x2="26" y2="25" />
  <line x1="29" y1="0" x2="29" y2="25" />
  <line x1="33" y1="0" x2="33" y2="25" />
  <line x1="37" y1="0" x2="37" y2="25" />
  <line x1="41" y1="0" x2="41" y2="25" />
  <line x1="44" y1="0" x2="44" y2="25" />
  <line x1="48" y1="0" x2="48" y2="25" />
  <line x1="52" y1="0" x2="52" y2="25" />
  <line x1="56" y1="0" x2="56" y2="25" />
  <line x1="59" y1="0" x2="59" y2="25" />
  <line x1="63" y1="0" x2="63" y2="25" />
  <line x1="67" y1="0" x2="67" y2="25" />
  <line x1="71" y1="0" x2="71" y2="25" />
  <line x1="74" y1="0" x2="74" y2="25" />
  <line x1="78" y1="0" x2="78" y2="25" />
  <line x1="82" y1="0" x2="82" y2="25" />
  <line x1="86" y1="0" x2="86" y2="25" />
  <line x1="89" y1="0" x2="89" y2="25" />
  <line x1="93" y1="0" x2="93" y2="25" />
  <line x1="97" y1="0" x2="97" y2="25" />
  <line x1="101" y1="0" x2="101" y2="25" />
  <line x1="105" y1="0" x2="105" y2="25" />
  <line x1="108" y1="0" x2="108" y2="25" />
  <line x1="112" y1="0" x2="112" y2="25" />
  <line x1="116" y1="0" x2="116" y2="25" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >14612</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="204" y2="14" style="stroke-width:2" />
  <line x1="190" y1="30" x2="204" y2="45" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="190" y2="30" style="stroke-width:2" />
  <line x1="204" y1="14" x2="204" y2="45" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 204.9485979497544,14.948597949754403 204.9485979497544,45.190852460757796 190.0,30.242254511003395" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="190" y1="0" x2="224" y2="0" style="stroke-width:2" />
  <line x1="204" y1="14" x2="239" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="190" y1="0" x2="204" y2="14" style="stroke-width:2" />
  <line x1="224" y1="0" x2="239" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="190.0,0.0 224.41151127943255,0.0 239.36010922918695,14.948597949754403 204.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="204" y1="14" x2="239" y2="14" style="stroke-width:2" />
  <line x1="204" y1="45" x2="239" y2="45" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="204" y1="14" x2="204" y2="45" style="stroke-width:2" />
  <line x1="239" y1="14" x2="239" y2="45" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="204.9485979497544,14.948597949754403 239.36010922918695,14.948597949754403 239.36010922918695,45.190852460757796 204.9485979497544,45.190852460757796" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="222.154354" y="65.190852" font-size="1.0rem" font-weight="100" text-anchor="middle" >720</text>
  <text x="259.360109" y="30.069725" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,259.360109,30.069725)">361</text>
  <text x="187.474299" y="57.716553" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,187.474299,57.716553)">32</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-c78bb7a9-337b-4e3f-851a-ab40d3e2212e' class='xr-section-summary-in' type='checkbox'  ><label for='section-c78bb7a9-337b-4e3f-851a-ab40d3e2212e' class='xr-section-summary' >Indexes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-66c75e8a-7cbf-47f2-8b98-053b007a8192' class='xr-index-data-in' type='checkbox'/><label for='index-66c75e8a-7cbf-47f2-8b98-053b007a8192' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2008-01-01 00:00:00&#x27;, &#x27;2008-01-01 06:00:00&#x27;,
               &#x27;2008-01-01 12:00:00&#x27;, &#x27;2008-01-01 18:00:00&#x27;,
               &#x27;2008-01-02 00:00:00&#x27;, &#x27;2008-01-02 06:00:00&#x27;,
               &#x27;2008-01-02 12:00:00&#x27;, &#x27;2008-01-02 18:00:00&#x27;,
               &#x27;2008-01-03 00:00:00&#x27;, &#x27;2008-01-03 06:00:00&#x27;,
               ...
               &#x27;2017-12-29 12:00:00&#x27;, &#x27;2017-12-29 18:00:00&#x27;,
               &#x27;2017-12-30 00:00:00&#x27;, &#x27;2017-12-30 06:00:00&#x27;,
               &#x27;2017-12-30 12:00:00&#x27;, &#x27;2017-12-30 18:00:00&#x27;,
               &#x27;2017-12-31 00:00:00&#x27;, &#x27;2017-12-31 06:00:00&#x27;,
               &#x27;2017-12-31 12:00:00&#x27;, &#x27;2017-12-31 18:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=14612, freq=None))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lev</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-e83e58e4-e02f-4dc3-ab07-0b4768c046bb' class='xr-index-data-in' type='checkbox'/><label for='index-e83e58e4-e02f-4dc3-ab07-0b4768c046bb' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([1000.0,  975.0,  950.0,  925.0,  900.0,  875.0,  850.0,  825.0,
               800.0,  775.0,  750.0,  700.0,  650.0,  600.0,  550.0,  500.0,
               450.0,  400.0,  350.0,  300.0,  250.0,  225.0,  200.0,  175.0,
               150.0,  125.0,  100.0,   70.0,   50.0,   30.0,   20.0,   10.0],
             dtype=&#x27;float64&#x27;, name=&#x27;lev&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-667ec104-2cb3-44eb-a6e5-73da9a68e366' class='xr-index-data-in' type='checkbox'/><label for='index-667ec104-2cb3-44eb-a6e5-73da9a68e366' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([-90.0, -89.5, -89.0, -88.5, -88.0, -87.5, -87.0, -86.5, -86.0,
              -85.5,
              ...
               85.5,  86.0,  86.5,  87.0,  87.5,  88.0,  88.5,  89.0,  89.5,
               90.0],
             dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=361))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-755632ed-463f-4435-a15e-d31aae07fc71' class='xr-index-data-in' type='checkbox'/><label for='index-755632ed-463f-4435-a15e-d31aae07fc71' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([-180.0, -179.5, -179.0, -178.5, -178.0, -177.5, -177.0, -176.5,
              -176.0, -175.5,
              ...
               175.0,  175.5,  176.0,  176.5,  177.0,  177.5,  178.0,  178.5,
               179.0,  179.5],
             dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=720))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-22d9634c-9a30-49c2-bd6f-68ef9cc7d0bd' class='xr-section-summary-in' type='checkbox'  checked><label for='section-22d9634c-9a30-49c2-bd6f-68ef9cc7d0bd' class='xr-section-summary' >Attributes: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>t 1000-10 hPa</dd><dt><span>year :</span></dt><dd>2008</dd><dt><span>source :</span></dt><dd>http://nomads.ncdc.noaa.gov/data.php?name=access#CFSR-data</dd><dt><span>references :</span></dt><dd>Saha, et. al., (2010)</dd><dt><span>creation_date :</span></dt><dd>Tue Feb 28 21:29:31 UTC 2012</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">v</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">u</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<p>Convert temperature to potential temperature:</p>
<div class="math notranslate nohighlight">
\[\theta = T \left(\frac{p_{ref}}{p}\right)^\kappa \]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\kappa = \frac{R}{c_p} = 0.286\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">climlab.utils.constants</span> <span class="kn">import</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">g</span>

<span class="n">sidereal_period</span> <span class="o">=</span> <span class="p">(</span><span class="mi">23</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="mi">56</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="mf">4.09053</span>  <span class="c1"># Earth&#39;s rotational period in seconds -- just shy of one day</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">sidereal_period</span>  <span class="c1"># Earth&#39;s angular rotation rate (radians / second)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">lev</span> <span class="o">*</span> <span class="mf">100.</span>  <span class="c1"># in units of Pa</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>  <span class="c1"># in units of radians</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>

<span class="n">f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>  <span class="c1"># everyone&#39;s favorite Coriolis parameter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pref</span> <span class="o">=</span> <span class="mf">1000.</span>  <span class="c1"># reference pressure in hPa</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="n">Rd</span><span class="o">/</span><span class="n">cp</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">pref</span><span class="o">/</span><span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">lev</span><span class="p">)</span><span class="o">**</span><span class="n">kappa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bracket</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">star</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span> <span class="o">-</span> <span class="n">bracket</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">cfsr_6hourly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">bar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="heat-flux">
<h3>Heat flux<a class="headerlink" href="#heat-flux" title="Permalink to this heading">#</a></h3>
<p>Compute the heat flux term</p>
<div class="math notranslate nohighlight">
\[\overline{[v^* \theta^*]}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">heatflux</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">bracket</span><span class="p">(</span><span class="n">star</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">star</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">heatflux</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (season: 4, lev: 32, lat: 361)&gt;
dask.array&lt;transpose, shape=(4, 32, 361), dtype=float32, chunksize=(1, 32, 361), chunktype=numpy.ndarray&gt;
Coordinates:
  * lev      (lev) float32 1e+03 975.0 950.0 925.0 900.0 ... 50.0 30.0 20.0 10.0
  * lat      (lat) float32 -90.0 -89.5 -89.0 -88.5 -88.0 ... 88.5 89.0 89.5 90.0
  * season   (season) object &#x27;DJF&#x27; &#x27;JJA&#x27; &#x27;MAM&#x27; &#x27;SON&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>season</span>: 4</li><li><span class='xr-has-index'>lev</span>: 32</li><li><span class='xr-has-index'>lat</span>: 361</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-1141f774-410b-435f-9262-72d1500b06ae' class='xr-array-in' type='checkbox' checked><label for='section-1141f774-410b-435f-9262-72d1500b06ae' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(1, 32, 361), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 180.50 kiB </td>
                        <td> 45.12 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (4, 32, 361) </td>
                        <td> (1, 32, 361) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 4 chunks in 91 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="195" height="103" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="10" y1="37" x2="25" y2="53" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="37" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="41" />
  <line x1="17" y1="7" x2="17" y2="45" />
  <line x1="21" y1="11" x2="21" y2="49" />
  <line x1="25" y1="15" x2="25" y2="53" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 25.241476922371035,15.241476922371037 25.241476922371035,53.159959566207846 10.0,37.91848264383681" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="133" y2="3" />
  <line x1="17" y1="7" x2="137" y2="7" />
  <line x1="21" y1="11" x2="141" y2="11" />
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="130" y1="0" x2="145" y2="15" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 145.24147692237105,15.241476922371037 25.241476922371035,15.241476922371037" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />
  <line x1="25" y1="53" x2="145" y2="53" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="25" y1="15" x2="25" y2="53" style="stroke-width:2" />
  <line x1="145" y1="15" x2="145" y2="53" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="25.241476922371035,15.241476922371037 145.24147692237102,15.241476922371037 145.24147692237102,53.159959566207846 25.241476922371035,53.159959566207846" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="85.241477" y="73.159960" font-size="1.0rem" font-weight="100" text-anchor="middle" >361</text>
  <text x="165.241477" y="34.200718" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,165.241477,34.200718)">32</text>
  <text x="7.620738" y="65.539221" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.620738,65.539221)">4</text>
</svg>
        </td>
    </tr>
</table></div></div></li><li class='xr-section-item'><input id='section-f2c76831-344f-4a45-8835-1e527f05221b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f2c76831-344f-4a45-8835-1e527f05221b' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lev</span></div><div class='xr-var-dims'>(lev)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1e+03 975.0 950.0 ... 20.0 10.0</div><input id='attrs-f13c9e12-7171-4382-a153-a75ce586f072' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f13c9e12-7171-4382-a153-a75ce586f072' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-565099da-5510-4d6a-8bef-c4ae75ef1e1e' class='xr-var-data-in' type='checkbox'><label for='data-565099da-5510-4d6a-8bef-c4ae75ef1e1e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>hPa</dd><dt><span>long_name :</span></dt><dd>isobaric_level</dd></dl></div><div class='xr-var-data'><pre>array([1000.,  975.,  950.,  925.,  900.,  875.,  850.,  825.,  800.,  775.,
        750.,  700.,  650.,  600.,  550.,  500.,  450.,  400.,  350.,  300.,
        250.,  225.,  200.,  175.,  150.,  125.,  100.,   70.,   50.,   30.,
         20.,   10.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-90.0 -89.5 -89.0 ... 89.5 90.0</div><input id='attrs-24e54f46-5982-4998-a6fe-e79b8228dd4c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-24e54f46-5982-4998-a6fe-e79b8228dd4c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-76ae1f74-2ca0-4330-acda-088322ea1791' class='xr-var-data-in' type='checkbox'><label for='data-76ae1f74-2ca0-4330-acda-088322ea1791' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>actual_range :</span></dt><dd>[-90  90]</dd><dt><span>delta_y :</span></dt><dd>0.5</dd><dt><span>coordinate_defines :</span></dt><dd>center</dd><dt><span>mapping :</span></dt><dd>cylindrical_equidistant_projection_grid</dd><dt><span>grid_resolution :</span></dt><dd>0.5_degrees</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([-90. , -89.5, -89. , ...,  89. ,  89.5,  90. ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>season</span></div><div class='xr-var-dims'>(season)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;DJF&#x27; &#x27;JJA&#x27; &#x27;MAM&#x27; &#x27;SON&#x27;</div><input id='attrs-dc4629e1-85ce-4205-af8a-8649faf2a4e8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-dc4629e1-85ce-4205-af8a-8649faf2a4e8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d3c93196-6a3c-4ac3-b57a-88f04bc5e0f2' class='xr-var-data-in' type='checkbox'><label for='data-d3c93196-6a3c-4ac3-b57a-88f04bc5e0f2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;DJF&#x27;, &#x27;JJA&#x27;, &#x27;MAM&#x27;, &#x27;SON&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6a6fa86d-eefd-449a-878f-6199418e93ed' class='xr-section-summary-in' type='checkbox'  ><label for='section-6a6fa86d-eefd-449a-878f-6199418e93ed' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lev</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-7c3e78d2-4c97-45f0-a100-2156736d6ee0' class='xr-index-data-in' type='checkbox'/><label for='index-7c3e78d2-4c97-45f0-a100-2156736d6ee0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([1000.0,  975.0,  950.0,  925.0,  900.0,  875.0,  850.0,  825.0,
               800.0,  775.0,  750.0,  700.0,  650.0,  600.0,  550.0,  500.0,
               450.0,  400.0,  350.0,  300.0,  250.0,  225.0,  200.0,  175.0,
               150.0,  125.0,  100.0,   70.0,   50.0,   30.0,   20.0,   10.0],
             dtype=&#x27;float64&#x27;, name=&#x27;lev&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-f11282b0-0e01-4318-b1d5-2ff61066358d' class='xr-index-data-in' type='checkbox'/><label for='index-f11282b0-0e01-4318-b1d5-2ff61066358d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([-90.0, -89.5, -89.0, -88.5, -88.0, -87.5, -87.0, -86.5, -86.0,
              -85.5,
              ...
               85.5,  86.0,  86.5,  87.0,  87.5,  88.0,  88.5,  89.0,  89.5,
               90.0],
             dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=361))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>season</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-b02e7002-f050-4646-a662-d9a18cce803a' class='xr-index-data-in' type='checkbox'/><label for='index-b02e7002-f050-4646-a662-d9a18cce803a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;DJF&#x27;, &#x27;JJA&#x27;, &#x27;MAM&#x27;, &#x27;SON&#x27;], dtype=&#x27;object&#x27;, name=&#x27;season&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b0ba7715-77a1-4e12-92cc-e5f2d384000c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b0ba7715-77a1-4e12-92cc-e5f2d384000c' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<p>Compute for solstice seasons:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">heatflux_computed</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">heatflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="n">heatflux</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">400</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">thisflux</span> <span class="o">=</span> <span class="n">heatflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">thisflux</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                               <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span>
                               <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eddy heat flux (K m/s), 2008-2017 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8e1a01a114c2f8759cf9d9b28a99fd1b679a514387a052980ae6aa7841211195.png" src="../_images/8e1a01a114c2f8759cf9d9b28a99fd1b679a514387a052980ae6aa7841211195.png" />
</div>
</div>
</section>
<section id="momentum-flux">
<h3>Momentum flux<a class="headerlink" href="#momentum-flux" title="Permalink to this heading">#</a></h3>
<p>Compute the momentum flux term</p>
<div class="math notranslate nohighlight">
\[ [u^* v^*] \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">momentumflux</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">bracket</span><span class="p">(</span><span class="n">star</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">star</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">momentumflux_computed</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">momentumflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="n">momentumflux</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">thisflux</span> <span class="o">=</span> <span class="n">momentumflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">thisflux</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                               <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span>
                               <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eddy momentum flux (m2/s2), 1988-2017 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b2c153948518308645a882d3ab248e702544b3b71767fa2aa5f50474ba80d152.png" src="../_images/b2c153948518308645a882d3ab248e702544b3b71767fa2aa5f50474ba80d152.png" />
</div>
</div>
</section>
<section id="stratification">
<h3>Stratification<a class="headerlink" href="#stratification" title="Permalink to this heading">#</a></h3>
<p>Compute the static stability term</p>
<div class="math notranslate nohighlight">
\[ \sigma = \frac{\partial [\overline{\theta}]}{\partial p} \]</div>
<p>in units of K Pa<span class="math notranslate nohighlight">\(^{-1}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta_zon</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">bracket</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">theta_zon</span><span class="o">.</span><span class="n">differentiate</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;lev&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span>  <span class="c1"># convert from K / hPa to K / Pa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_computed</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">sigma_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">thissigma</span> <span class="o">=</span> <span class="n">sigma_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">thissigma</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                               <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span>
                               <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stratification parameter (K / Pa), 2008-2017 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c77365a24dc940d7bc40633fbc2afb30718623e4c14b3892aba9e19f97550f40.png" src="../_images/c77365a24dc940d7bc40633fbc2afb30718623e4c14b3892aba9e19f97550f40.png" />
</div>
</div>
</section>
<section id="the-rescaled-hat-components">
<h3>The rescaled “hat” components<a class="headerlink" href="#the-rescaled-hat-components" title="Permalink to this heading">#</a></h3>
<p>Define the quantity <span class="math notranslate nohighlight">\(\Delta\)</span> as</p>
<div class="math notranslate nohighlight">
\[ \Delta = \frac{\partial}{\partial \phi} \hat{F}_\phi + \frac{\partial}{\partial p} \hat{F}_p\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\hat{F}_\phi &amp;= \frac{2\pi a}{g} \cos\phi F_\phi \\
\hat{F}_p &amp;= \frac{2 \pi a^2}{g} \cos\phi F_p
\end{align*}\]</div>
<p>so that <span class="math notranslate nohighlight">\(\Delta d\phi dp\)</span> is the divergence of <span class="math notranslate nohighlight">\(\vec{F}\)</span> weighted by the mass of the annulus <span class="math notranslate nohighlight">\(d\phi dp\)</span>.</p>
</section>
<section id="plotting-the-ep-flux-diagram">
<h3>Plotting the EP flux diagram<a class="headerlink" href="#plotting-the-ep-flux-diagram" title="Permalink to this heading">#</a></h3>
<p>We will plot contours of <span class="math notranslate nohighlight">\(\Delta\)</span> to best represent the eddy forcing of the mean flow. <em>Note that <span class="math notranslate nohighlight">\(\Delta\)</span> has dimensions of length cubed.</em></p>
<p>Similarly, we will represent <span class="math notranslate nohighlight">\(\vec{F}\)</span> by plotting arrows whose horizontal and vertical components are respectively proportional to <span class="math notranslate nohighlight">\(\hat{F}_\phi\)</span> and <span class="math notranslate nohighlight">\(\hat{F}_p\)</span>. However we re-scale the vertical component by a factor related to the aspect ratio of the plot: vertical distance per Pa / horizontal distance per radian.</p>
<p>This allows for a more natural visual interpretation of the plot, since arrow lengths in the horizontal and vertical now correspond directly to their contribution to the divergence.</p>
<p>The resulting graph is precisely the Eliassen-Palm cross-section defined by <span id="id4">Edmon Jr. <em>et al.</em> [<a class="reference internal" href="../info/references.html#id16" title="H. J. Edmon Jr., B.J. Hoskins, and M.E. McIntyre. Eliassen-Palm cross sections for the troposphere. J. Atmos. Sci., 37:2600–2616, 1980. doi:10.1175/1520-0469(1980)037&lt;2600:EPCSFT&gt;2.0.CO;2.">1980</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_ep_flux</span><span class="p">(</span><span class="n">heatflux</span><span class="p">,</span> <span class="n">momentumflux</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;aspect is vertical distance per hPa / horizontal distance per degree (in figure units)&#39;&#39;&#39;</span>
    
    <span class="c1"># Calculate the physical div F (not the hat version that is used for plotting, see Edmon et al.)</span>
    <span class="n">F_phi</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">momentumflux</span>  <span class="c1"># in units of m^3/s^2</span>
    <span class="n">F_p</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">heatflux</span> <span class="o">/</span> <span class="n">sigma</span>  <span class="c1"># in units of Pa m^2/s^2   </span>
    <span class="c1"># The rescaled &quot;hat&quot; components</span>
    <span class="n">Fhat_phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">F_phi</span>  <span class="c1"># in units of m^3</span>
    <span class="n">Fhat_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">F_p</span>   <span class="c1"># in units of Pa m^3</span>
    <span class="c1"># Compute divergence</span>
    <span class="n">Delta_phi</span> <span class="o">=</span> <span class="n">Fhat_phi</span><span class="o">.</span><span class="n">differentiate</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>  <span class="c1"># In m^3 / degree</span>
    <span class="n">Delta_phi</span> <span class="o">*=</span> <span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># Now in m^3 / radian = m^3</span>
    <span class="n">Delta_p</span> <span class="o">=</span> <span class="n">Fhat_p</span><span class="o">.</span><span class="n">differentiate</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;lev&#39;</span><span class="p">)</span>  <span class="c1"># Now in Pa m^3 / hPa</span>
    <span class="n">Delta_p</span> <span class="o">/=</span> <span class="mf">100.</span>  <span class="c1"># In Pa m^3 / Pa = m^3</span>
    <span class="n">Delta</span> <span class="o">=</span> <span class="n">Delta_phi</span> <span class="o">+</span> <span class="n">Delta_p</span>  <span class="c1"># in units of m^3</span>
    
    <span class="n">aspect</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># vertical distance per hPa / horizontal distance per degree (in figure units)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">aspect</span> <span class="o">/</span> <span class="mf">100.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>  <span class="c1"># vertical distance per Pa / horizontal distance per radian</span>

    <span class="c1"># multiply the F_p component by A so that the arrows are properly scaled.</span>
    <span class="c1"># The factor -1 is necessary to correct a sign issue with the quiver plot</span>
    <span class="c1"># Presumably because the pressure axis is increasing downward</span>
    <span class="n">Fhat_scaled</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s2">&quot;Fhat_phi&quot;</span><span class="p">:</span> <span class="n">Fhat_phi</span><span class="p">,</span> <span class="s2">&quot;Fhat_p&quot;</span><span class="p">:</span> <span class="n">Fhat_p</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>
    
    <span class="c1"># If we plot the data as-is, there will be far too many arrows because of the high spatial resolution of the data.</span>
    <span class="c1"># We will down-sample in the latitude dimension before plotting the arrows.</span>
    <span class="n">coarseFhat</span> <span class="o">=</span> <span class="n">Fhat_scaled</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s2">&quot;pad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">Delta_phi</span><span class="p">,</span> <span class="n">Delta_p</span><span class="p">,</span> <span class="n">coarseFhat</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Delta</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Delta_phi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Delta_p</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">coarseFhat</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">Delta</span><span class="p">[</span><span class="n">season</span><span class="p">],</span> <span class="n">Delta_phi</span><span class="p">[</span><span class="n">season</span><span class="p">],</span> <span class="n">Delta_p</span><span class="p">[</span><span class="n">season</span><span class="p">],</span> <span class="n">coarseFhat</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">compute_ep_flux</span><span class="p">(</span><span class="n">heatflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">],</span> 
                        <span class="n">momentumflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">],</span>
                        <span class="n">sigma_computed</span><span class="p">[</span><span class="n">season</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">epfluxplot</span><span class="p">(</span><span class="n">Delta</span><span class="p">,</span> <span class="n">Fhat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span>
             <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>
             <span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Delta</span><span class="o">/</span><span class="mf">1E15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> 
                               <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span>
                                   <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">Fhat</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lev&quot;</span><span class="p">,</span> 
                     <span class="n">u</span><span class="o">=</span><span class="s2">&quot;Fhat_phi&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="s2">&quot;Fhat_p&quot;</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EP flux and divergence, 2008-2017 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">epfluxplot</span><span class="p">(</span><span class="n">Delta</span><span class="p">[</span><span class="n">season</span><span class="p">],</span> <span class="n">coarseFhat</span><span class="p">[</span><span class="n">season</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">season</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4c41a23cf05671aee4a04bcca0dbb28f39fbba472b1e8209340bd03b5de01e81.png" src="../_images/4c41a23cf05671aee4a04bcca0dbb28f39fbba472b1e8209340bd03b5de01e81.png" />
<img alt="../_images/c8277ed588efed078994f7119b6f47a4afcd0d496c24062593db7b3bb899bfb3.png" src="../_images/c8277ed588efed078994f7119b6f47a4afcd0d496c24062593db7b3bb899bfb3.png" />
</div>
</div>
</section>
<section id="interpreting-the-ep-flux-diagram">
<h3>Interpreting the EP flux diagram<a class="headerlink" href="#interpreting-the-ep-flux-diagram" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In the winter hemisphere, the flux is convergent throughout much of the midlatitude troposphere, indicating that the eddy fluxes are acting to decelerate the zonal wind.</p></li>
<li><p>This effect is concentrated into three lobes, respectively centered at roughly (35º, 850 hPa), (50º, 500 hPa) and (20º, 250 hPa) in both winter hemispheres.</p></li>
<li><p>Strongest divergences and convergences occur near the lower boundary.</p>
<ul>
<li><p>Strongly divergent flux in the lowest levels throughout much of the mid-latitudes.</p></li>
<li><p>Consistent with quasi-geostrophic theory in the presence of a meridional temperature gradient, which forces <span class="math notranslate nohighlight">\(F_p\)</span> to zero at the boundary but strongly divergent immediately above the boundary.</p></li>
</ul>
</li>
<li><p>The net effect of the eddy fluxes (in the winter season at least) is a</p>
<ul>
<li><p>deceleration of the zonal wind aloft, and</p></li>
<li><p>acceleration near the surface.</p></li>
</ul>
</li>
<li><p>In other words, the eddies are acting to neutralize the vertical shear, or through the thermal wind balance, to neutralize the meridional temperature gradient.</p></li>
</ul>
<p>The divergence near the boundary does not show a strong seasonal variation. Away from the boundary, the fluxes and their divergences become significantly weaker in the summer season. This is consistent with greater eddy activity in the winter season, especially in the NH.</p>
<p>One of the big advantages of presenting the eddy flux data in the form of EP cross-sections is that it gives us an immediate visual indication of the relative importance of eddy heat and momentum fluxes to the eddy PV flux.</p>
<ul class="simple">
<li><p>Arrows in our EP diagrams are nearly vertical throughout most of the troposphere, indicating the dominance of the eddy heat fluxes.</p></li>
<li><p>The arrows have a horizontal component in the subtropical upper troposphere.</p></li>
<li><p>This is the region where the momentum flux is strongly divergent, as we saw above.</p></li>
</ul>
<p>Our EP flux diagram gives a more complete picture of the eddy forcing of the mean flow than the original Eliassen-Palm cross-sections presented by <span id="id5">Edmon Jr. <em>et al.</em> [<a class="reference internal" href="../info/references.html#id16" title="H. J. Edmon Jr., B.J. Hoskins, and M.E. McIntyre. Eliassen-Palm cross sections for the troposphere. J. Atmos. Sci., 37:2600–2616, 1980. doi:10.1175/1520-0469(1980)037&lt;2600:EPCSFT&gt;2.0.CO;2.">1980</a>]</span>, due to the global span and higher resolution of our data.</p>
</section>
</section>
<section id="concluding-remarks-about-the-eliassen-palm-flux-plots">
<h2>Concluding remarks about the Eliassen-Palm flux plots<a class="headerlink" href="#concluding-remarks-about-the-eliassen-palm-flux-plots" title="Permalink to this heading">#</a></h2>
<p>Quoting from the summary from <span id="id6">Edmon Jr. <em>et al.</em> [<a class="reference internal" href="../info/references.html#id16" title="H. J. Edmon Jr., B.J. Hoskins, and M.E. McIntyre. Eliassen-Palm cross sections for the troposphere. J. Atmos. Sci., 37:2600–2616, 1980. doi:10.1175/1520-0469(1980)037&lt;2600:EPCSFT&gt;2.0.CO;2.">1980</a>]</span>:</p>
<blockquote>
<div><p>EP cross sections and the transformed mean-flow equations furnish a powerful and practical way of viewing the dynamics of eddies on a zonal wind, whether in the troposphere or in the middle atmosphere, and whether or not the eddies are well described by linear wave theory… The information displayed on an EP cross section comes as close to the heart of the eddy, mean flow interaction problem as seems likely to be possible for any Eulerian diagnostic…</p>
</div></blockquote>
<p>They furthermore throw out some ideas for future work:</p>
<blockquote>
<div><p>For the troposphere it would be of great interest to see the EP cross sections for different zonal wave-numbers… Individual days would be of interest as well as seasonal averages. If such cross sections could be obtained despite the formidable data-quality problems, they would give a revealing view of the horizontal, vertical and temporal structure of the interactions among different kinds of eddy and the zonal-mean state.</p>
</div></blockquote>
<p>Now that reanalysis datasets have largely solved the “formidable data-quality problems”, it would be great fun to revisit some of these problems.</p>
</section>
<section id="the-residual-mean-overturning">
<h2>The residual mean overturning<a class="headerlink" href="#the-residual-mean-overturning" title="Permalink to this heading">#</a></h2>
<section id="id7">
<h3>The idea<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<p>We’ve defined a residual meridonal velocity</p>
<div class="math notranslate nohighlight">
\[ v_{res} = [v] - \frac{\partial}{\partial p} \left( \frac{ [v^*\theta^*]}{\sigma} \right) \]</div>
<p>that is “corrected” by the eddy heat fluxes that we already computed.</p>
<p>What is the mass-conserving overturning <span class="math notranslate nohighlight">\(\psi_{res}\)</span> associated with this <span class="math notranslate nohighlight">\(v_{res}\)</span>? It should get us a little closer to a <em>Lagrangian</em> perspective, that is, what is the typical trajectory experienced by a parcel that is heating near the equator and cooled at higher latitudes?</p>
<p>In our qualitative arguments above, we infered that <span class="math notranslate nohighlight">\(\psi_{res}\)</span> ought to have a single-cell, equator-to-pole character – quite different from the Eulerian mean <span class="math notranslate nohighlight">\(\psi\)</span>.</p>
<p>Let’s see what we can get from the data.</p>
</section>
<section id="formulas">
<h3>Formulas<a class="headerlink" href="#formulas" title="Permalink to this heading">#</a></h3>
<p>Consider that <span class="math notranslate nohighlight">\([v]\)</span> is related to the Eulerian mean streamfunction <span class="math notranslate nohighlight">\(\psi\)</span> through</p>
<div class="math notranslate nohighlight">
\[ \frac{2 \pi a \cos\phi}{g} [v] = \frac{\partial \psi}{\partial p} \]</div>
<p>so the sensible thing to do is to define an analogous relationship for <span class="math notranslate nohighlight">\(\psi_{res}\)</span>:</p>
<div class="math notranslate nohighlight">
\[ \frac{2 \pi a \cos\phi}{g} v_{res} = \frac{\partial \psi_{res}}{\partial p} \]</div>
<p>Then taking our definition of <span class="math notranslate nohighlight">\(v_{res}\)</span> above, multiplying through by <span class="math notranslate nohighlight">\(\frac{2 \pi a \cos\phi}{g}\)</span>, integrating each term in <span class="math notranslate nohighlight">\(p\)</span> and assuming that horizontal fluxes are small at the top of the atmosphere, we get</p>
<div class="math notranslate nohighlight">
\[ \psi_{res} = \psi - \frac{2 \pi a \cos\phi}{g}  \left( \frac{ [v^*\theta^*]}{\sigma} \right) \]</div>
<p>We can readily compute and plot this!</p>
</section>
<section id="compute-eulerian-mean-streamfunction">
<h3>Compute Eulerian mean streamfunction<a class="headerlink" href="#compute-eulerian-mean-streamfunction" title="Permalink to this heading">#</a></h3>
<p>Start by calculating <span class="math notranslate nohighlight">\(\psi(\phi, p)\)</span> as we’ve done before.</p>
<p>First we need <span class="math notranslate nohighlight">\([v]\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v_zon</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">bracket</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v_zon_computed</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">v_zon_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_zon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>and then we integrate in pressure to get <span class="math notranslate nohighlight">\(\psi\)</span>:</p>
<div class="math notranslate nohighlight">
\[ \psi = \frac{2 \pi a \cos\phi}{g} \int_0^p [v] dp \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="c1"># Use units of 10^9 kg/s</span>
    <span class="n">psi</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">g</span> <span class="o">*</span> <span class="n">v_zon_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">.</span><span class="n">cumulative_integrate</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;lev&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1E9</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="c1"># Need to multiply by 100 because the &#39;lev&#39; coordinate is in units of hPa, not Pa</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-residual-using-eddy-heat-flux-correction">
<h3>Compute residual using eddy heat flux correction<a class="headerlink" href="#compute-residual-using-eddy-heat-flux-correction" title="Permalink to this heading">#</a></h3>
<p>Now calculate <span class="math notranslate nohighlight">\(\psi_{res}\)</span> using</p>
<div class="math notranslate nohighlight">
\[ \psi_{res} = \psi - \frac{2 \pi a \cos\phi}{g}  \left( \frac{ [v^*\theta^*]}{\sigma} \right) \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi_res</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]:</span>
    <span class="n">psi_res</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">g</span> <span class="o">*</span> <span class="n">heatflux_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">/</span><span class="n">sigma_computed</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1E9</span>
    <span class="c1"># Also in units of 10^9 kg/s</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-residual-streamfunction-and-compare-to-eulerian-mean">
<h3>Plot the residual streamfunction and compare to Eulerian mean<a class="headerlink" href="#plot-the-residual-streamfunction-and-compare-to-eulerian-mean" title="Permalink to this heading">#</a></h3>
<p>We will plot the Eulerian mean <span class="math notranslate nohighlight">\(\psi\)</span> in blue, and overlay with the residual mean <span class="math notranslate nohighlight">\(\psi_{res}\)</span> in magenta:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">240</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">20.</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="s1">&#39;JJA&#39;</span><span class="p">]):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">CSpsi</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                       <span class="n">x</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> 
                                       <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">levels</span><span class="o">=</span><span class="n">psi_levels</span><span class="p">,</span>
                                       <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span>
                                            <span class="p">)</span>
    <span class="n">CSpsires</span> <span class="o">=</span> <span class="n">psi_res</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                       <span class="n">x</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> 
                                       <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">levels</span><span class="o">=</span><span class="n">psi_levels</span><span class="p">,</span>
                                       <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
                                            <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CSpsires</span><span class="p">,</span> <span class="n">CSpsires</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual mean mass overturning (10^9 kg/s), 2008-2017 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/52d5a66714b5757fe94c6198cc9670fc1ed4f41b837cd7d1e122be919d10d938.png" src="../_images/52d5a66714b5757fe94c6198cc9670fc1ed4f41b837cd7d1e122be919d10d938.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "daes_nov22"
        },
        kernelOptions: {
            name: "daes_nov22",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'daes_nov22'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="hadley.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Theories of the Hadley circulation</p>
      </div>
    </a>
    <a class="right-next"
       href="../assignments/assignment-toa-budget.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Top-of-Atmosphere Radiation Budget and Meridional Energy Transport</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-transformed-eulerian-mean-tem-or-residual-circulation">The Transformed Eulerian Mean (TEM) or “Residual Circulation”</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-residual-overturning-required-by-diabatic-heating">The residual overturning required by diabatic heating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acceleration-of-the-zonal-mean-wind">Acceleration of the zonal mean wind</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-eliassen-palm-flux-vector">The Eliassen-Palm flux vector</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-potential-vorticity-perspective">A potential vorticity perspective</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-idea">The idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zonal-average-qgpv-equation">Zonal average QGPV equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-perspective-on-the-steady-balanced-circulation">A perspective on the steady, balanced circulation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tem-equations-for-the-atmosphere">TEM equations for the atmosphere</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ep-flux-vector-components-for-the-atmosphere">The EP flux vector components for the atmosphere</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complete-set-of-tem-equations-for-the-atmosphere">Complete set of TEM equations for the atmosphere</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-residual-mean-for-the-atmosphere">The residual mean for the atmosphere</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-angular-momentum-equation">An angular momentum equation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-eliassen-palm-cross-section-from-reanalysis-data">Plotting the Eliassen-Palm cross-section from reanalysis data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-classic-figure">The classic figure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-cfsr-data-and-get-to-work">Load the CFSR data and get to work</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#heat-flux">Heat flux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#momentum-flux">Momentum flux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stratification">Stratification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rescaled-hat-components">The rescaled “hat” components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-ep-flux-diagram">Plotting the EP flux diagram</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-ep-flux-diagram">Interpreting the EP flux diagram</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concluding-remarks-about-the-eliassen-palm-flux-plots">Concluding remarks about the Eliassen-Palm flux plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-residual-mean-overturning">The residual mean overturning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">The idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formulas">Formulas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-eulerian-mean-streamfunction">Compute Eulerian mean streamfunction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-residual-using-eddy-heat-flux-correction">Compute residual using eddy heat flux correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-residual-streamfunction-and-compare-to-eulerian-mean">Plot the residual streamfunction and compare to Eulerian mean</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Brian E. J. Rose
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>